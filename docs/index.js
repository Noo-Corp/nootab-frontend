var calendar={monthNamesFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["SUN","MON","TUE","WED","THU","FRI","SAT"],data:null,curDay:0,curMonth:0,curYear:0,draw:function(){calendar.curMonth=parseInt(document.getElementById("sMonth").value),calendar.curYear=parseInt(document.getElementById("sYear").value);var t=new Date(calendar.curYear,calendar.curMonth+1,0).getDate(),a=new Date(calendar.curYear,calendar.curMonth,1).getDay(),n=new Date(calendar.curYear,calendar.curMonth,t).getDay();calendar.data=localStorage.getItem("calendar"+calendar.curMonth+calendar.curYear),null==calendar.data?(localStorage.setItem("calendar"+calendar.curMonth+calendar.curYear,"{}"),calendar.data={}):calendar.data=JSON.parse(calendar.data);for(var l=[],r=0;r<a;r++)l.push(" ");for(var r=1;r<t+1;r++)l.push(r);for(var r=0;r<6-n;r++)l.push(" ");for(;l.length<42;)l.push(" ");var o=document.getElementById("calContainer"),c=document.createElement("table");c.id="calendar",o.innerHTML="";var d=document.createElement("tr");d.id="dayRow";for(var s=calendar.dayNames,i=s.length,m=document.createDocumentFragment(),r=0;r<i;r++){var u=document.createElement("td");u.innerHTML=s[r],m.appendChild(u)}d.appendChild(m),c.appendChild(d);let y=new Date,p=String(y.getDate()),v=document.createDocumentFragment();for(let g=0;g<6;g++){let E=document.createElement("tr");E.id="day";let h=0;for(let f=0;f<7;f++){let k=document.createElement("td");if(k.innerHTML=l[7*g+f]," "===l[7*g+f])k.id="empty",h++;else{let b=l[7*g+f];if(k.innerHTML=`<div class='cell'>${b}</div>`,calendar.data[b]){let $=y.getFullYear(),I=y.getMonth();if(calendar.curYear===$&&calendar.curMonth===I&&b==p){let x=calendar.data[b].replace(/\n/g,"<br>");k.innerHTML=`<div id="current-day" style="padding: 12px;"><div class='cell'>${b}</div>${x}</div>`,k.style.padding="0px",k.style.position="relative"}else{let L=calendar.data[b].replace(/\n/g,"<br>");k.innerHTML+=L}}else k.style.height="64px",calendar.curYear===y.getFullYear()&&calendar.curMonth===y.getMonth()&&b==p&&(k.innerHTML=`<div id="current-day" style="display: flex;"><div class='cell'>${b}</div></div>`,k.style.padding="0px",k.style.position="relative");k.addEventListener("click",()=>calendar.show(k))}E.appendChild(k)}7!==h&&v.appendChild(E)}c.appendChild(v),o.appendChild(c),calendar.close()},show:function(t){let a=document.getElementById("calEvent"),n=document.createElement("form");n.addEventListener("submit",calendar.save),a.innerHTML="",calendar.curDay=t.querySelector(".cell").textContent;let l="<h1>"+(calendar.data[calendar.curDay]?"EDIT EVENT":"ADD EVENT")+"</h1>";l+="<p>"+calendar.monthNamesFull[calendar.curMonth]+" "+calendar.curDay+", "+calendar.curYear+"</p>",l+="<textarea id='inputDetails' required>"+(calendar.data[calendar.curDay]||"")+"</textarea>",l+="<input type='button' value='Delete' onclick='calendar.delete()'/>",l+="<input type='button' value='Cancel' onclick='calendar.close()'/>",l+="<input type='submit' value='Save'/>",n.innerHTML=l,a.appendChild(n),a.style.display="block",setTimeout(()=>a.classList.add("show"),0);let r=a.querySelector("textarea");r.focus(),r.setSelectionRange(r.value.length,r.value.length),document.addEventListener("click",closeOnClick),document.addEventListener("keydown",closeOnClick)},save:function(t){t.stopPropagation(),t.preventDefault(),calendar.data[calendar.curDay]=document.getElementById("inputDetails").value,localStorage.setItem("calendar"+calendar.curMonth+calendar.curYear,JSON.stringify(calendar.data)),calendar.draw()},delete:function(){if(calendar.data[calendar.curDay])delete calendar.data[calendar.curDay],localStorage.setItem("calendar"+calendar.curMonth+calendar.curYear,JSON.stringify(calendar.data)),calendar.draw();else{var t=document.getElementById("calEvent").querySelector("textarea");t.value="",t.focus()}},close:function(){(e=document.getElementById("calEvent")).classList.remove("show"),e.style.display="none",document.removeEventListener("click",closeOnClick)}};function documentKeyHandler(t){if("Tab"===t.key){if("none"===document.getElementById("calEvent").style.display){t.preventDefault();var a,n=localStorage.getItem("panel-main");"calendar"==n?a="notes":"notes"==n&&(a="calendar"),openMode(a)}}else t.ctrlKey&&"s"===t.key&&"block"==document.getElementById("notes").style.display&&(t.preventDefault(),saveNote())}function logoClick(){let t=document.getElementById("logo");if("#F5F5F5"===localStorage.getItem("colour-mode-back")||null===localStorage.getItem("colour-mode-back"))t.classList.remove("animate"),t.offsetWidth,t.classList.add("animate");else{let a=document.querySelector(".zzz-container"),n=a.querySelectorAll("div");n.forEach(function(t){t.classList.add("zzz-animate"),t.textContent="Z",t.addEventListener("animationend",function(){t.classList.remove("zzz-animate"),t.textContent=""})}),t.classList.remove("pulse"),t.offsetWidth,t.classList.add("pulse")}}function popupClick(){let t=document.querySelector(".popup");localStorage.setItem("popup-dismissed","true"),t.style.display="none"}function collToggle(){this.classList.toggle("active");var t=this.nextElementSibling;t.style.maxHeight?t.style.maxHeight=null:t.style.maxHeight=t.scrollHeight+"px"}function closeOnClick(t){calEvent=document.getElementById("calEvent"),"click"==t.type?!document.querySelector("#calEvent").classList.contains("show")||calEvent.contains(t.target)||t.target.closest("td")&&"dayRow"!=t.target.closest("tr").id&&"empty"!=t.target.closest("td").id||(calendar.close(),document.removeEventListener("click",closeOnClick)):"keydown"==t.type&&"Escape"===t.key&&(calendar.close(),document.removeEventListener("keydown",closeOnClick))}function getTextColor(t){let a=parseInt(t.substr(1,2),16),n=parseInt(t.substr(3,2),16),l=parseInt(t.substr(5,2),16);return .299*a+.587*n+.114*l>186?"#424242":"#F5F5F5"}function toggleDarkMode(){let t=document.querySelector("#darkmode-button img"),a=document.querySelector("#logo img"),n="#F5F5F5",l="#424242";"images/light-mode.png"===t.getAttribute("src")?(t.src="images/dark-mode.png",a.src="images/logo-awake.png",document.documentElement.style.setProperty("--bodyback","#E8E8E8"),document.documentElement.style.setProperty("--modeback",n),document.documentElement.style.setProperty("--modetext",l),localStorage.setItem("colour-mode-back",n),localStorage.setItem("colour-mode-text",l)):(t.src="images/light-mode.png",a.src="images/logo-asleep.png",document.documentElement.style.setProperty("--bodyback","#363636"),document.documentElement.style.setProperty("--modeback",l),document.documentElement.style.setProperty("--modetext",n),localStorage.setItem("colour-mode-back",l),localStorage.setItem("colour-mode-text",n))}function hexToHsv(t){var a,n,l,r=parseInt(t.substring(1,3),16),o=parseInt(t.substring(3,5),16),c=parseInt(t.substring(5,7),16),d=Math.max(r,o,c),s=d-Math.min(r,o,c);return n=0===d?0:s/d,0===s?a=0:(a=r===d?(o-c)/s:o===d?2+(c-r)/s:4+(r-o)/s,(a*=60)<0&&(a+=360)),{h:a,s:n,v:l=d/255}}function hsvToHex(t){"string"==typeof t&&(t=JSON.parse(t));var a,n,l,r=t.v*t.s,o=r*(1-Math.abs(t.h/60%2-1)),c=t.v-r;return t.h>=0&&t.h<60?(a=r,n=o,l=0):t.h>=60&&t.h<120?(a=o,n=r,l=0):t.h>=120&&t.h<180?(a=0,n=r,l=o):t.h>=180&&t.h<240?(a=0,n=o,l=r):t.h>=240&&t.h<300?(a=o,n=0,l=r):(a=r,n=0,l=o),a=Math.round((a+c)*255),"#"+(16777216+(a<<16)+((n=Math.round((n+c)*255))<<8)+(l=Math.round((l+c)*255))).toString(16).slice(1)}function generatePalette(t){var a={},n=t.v-.21;n<0&&(n=t.v+.21);var l=t.v+.08;if(l>1&&(l=t.v-.08),10>Math.abs(98.5-t.h))var r=Math.abs(360-t.h);else var r=Math.abs(197-t.h);var o=t.v+.08;return o>1&&(o=t.v-.08),a.c1={h:t.h,s:t.s,v:n},a.c2={h:t.h,s:t.s,v:l},a.c3={h:r,s:t.s,v:t.v},a.c4={h:r,s:t.s,v:o},a}function openMode(t){var a,n,l;for(a=0,n=document.getElementsByClassName("mode");a<n.length;a++)n[a].style.display="none";for(a=0,l=document.getElementsByClassName("panel-mode");a<n.length;a++)l[a].style.borderBottom="6px solid #646464",l[a].style.color="#646464";document.getElementById(t).style.display="block",document.getElementById(t+"-select").style.borderBottom="6px solid var(--top)",document.getElementById(t+"-select").style.color="var(--top)","notes"==t?(localStorage.setItem("panel-main","notes"),document.getElementById("editor").focus()):"calendar"==t&&(localStorage.setItem("panel-main","calendar"),document.querySelector(".search-bar form input").focus())}function saveNote(){localStorage.setItem("notes-main",document.getElementById("editor").innerHTML),document.getElementById("editor-save-btn").textContent="Save",document.getElementById("editor-alert").style.display="none"}function indicateSave(){document.getElementById("editor-save-btn").textContent="*Save",document.getElementById("editor-alert").style.display="block"}function format(t,a){document.execCommand(t,!1,a),document.getElementById("editor").focus()}function setUrl(){let t=document.getElementById("tool-url"),a=document.getSelection();""!=t.value&&(document.getElementById("editor").focus(),""!=a?document.execCommand("insertHTML",!1,'<a class="editor-link" href="'+t.value+'" onclick="event.preventDefault(); window.open(\''+t.value+"', '_blank');\">"+a+"</a>"):document.execCommand("insertHTML",!1,'<a class="editor-link" href="'+t.value+'" onclick="event.preventDefault(); window.open(\''+t.value+"', '_blank');\">"+t.value+"</a>"),t.value="")}window.addEventListener("load",function(){for(var t,a=new Date,n=document.getElementById("sMonth"),l=document.getElementById("sYear"),t=0;t<12;t++){var r=document.createElement("option");r.value=t,r.innerHTML=calendar.monthNames[t],t==a.getMonth()&&(r.selected=!0),n.appendChild(r)}for(var t=2023;t<a.getFullYear()+6;t++){var r=document.createElement("option");r.value=t,r.innerHTML=t,t==a.getFullYear()&&(r.selected=!0),l.appendChild(r)}document.getElementById("btnShow").addEventListener("click",calendar.draw),calendar.draw(),document.addEventListener("keydown",documentKeyHandler);var o=localStorage.getItem("panel-main")||"calendar";document.getElementById(o).style.display="block",document.getElementById(o+"-select").style.borderBottom="6px solid var(--top)",document.getElementById(o+"-select").style.color="var(--top)",localStorage.setItem("panel-main",o);var c=localStorage.getItem("colour-main")||"#ed6461",d=hexToHsv(c),s=localStorage.getItem("colour-mode-back")||"#F5F5F5",i=localStorage.getItem("colour-mode-text")||"#424242",m=generatePalette(d);document.documentElement.style.setProperty("--main",c),document.documentElement.style.setProperty("--modeback",s),document.documentElement.style.setProperty("--modetext",i),document.documentElement.style.setProperty("--header",getTextColor(hsvToHex(m.c3))),document.documentElement.style.setProperty("--text",getTextColor(c)),document.documentElement.style.setProperty("--empty",hsvToHex(m.c1)),document.documentElement.style.setProperty("--hover",hsvToHex(m.c2)),document.documentElement.style.setProperty("--top",hsvToHex(m.c3)),document.documentElement.style.setProperty("--tophover",hsvToHex(m.c4));let u=document.querySelector(".colour-picker-button"),y=document.querySelector(".colour-picker-button img");y.src="images/colour-wheel.png",u.addEventListener("click",function(){let t=document.createElement("input");t.type="color",t.addEventListener("change",function(){var a=t.value,n=hexToHsv(a),l=generatePalette(n);document.documentElement.style.setProperty("--main",a),document.documentElement.style.setProperty("--header",getTextColor(hsvToHex(l.c3))),document.documentElement.style.setProperty("--text",getTextColor(a)),document.documentElement.style.setProperty("--empty",hsvToHex(l.c1)),document.documentElement.style.setProperty("--hover",hsvToHex(l.c2)),document.documentElement.style.setProperty("--top",hsvToHex(l.c3)),document.documentElement.style.setProperty("--tophover",hsvToHex(l.c4)),localStorage.setItem("colour-main",a)}),t.click(),t.addEventListener("blur",function(){t.remove()}),document.addEventListener("click",function(a){t.contains(a.target)||a.target===u||t.remove()})});let p=document.querySelector("#darkmode-button"),v=document.querySelector("#darkmode-button img"),g=document.querySelector("#logo img");"#424242"==s?(v.src="images/light-mode.png",g.src="images/logo-asleep.png",document.documentElement.style.setProperty("--bodyback","#363636")):(v.src="images/dark-mode.png",g.src="images/logo-awake.png",document.documentElement.style.setProperty("--bodyback","#E8E8E8")),p.addEventListener("click",toggleDarkMode);let E=document.querySelector(".popup");localStorage.getItem("popup-dismissed")?E.style.display="none":E.style.display="block",document.getElementById("close-popup").addEventListener("click",popupClick);var h=document.getElementsByClassName("collapsible");for(t=0;t<h.length;t++)h[t].addEventListener("click",collToggle);document.getElementById("logo").addEventListener("click",logoClick);var f=document.querySelector(".search-bar form input");f.focus(),f.style.background="var(--modeback)";let k=localStorage.getItem("notes-main")||"";document.getElementById("editor").innerHTML=k,document.getElementById("editor-save-btn").addEventListener("click",saveNote),document.getElementById("editor").addEventListener("input",indicateSave)});