var refreshInterval=null;function updateRefreshedAtTime(){let e=document.getElementById("main-title"),t=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});e.textContent=`Refreshed at ${t}`}function formatReceivedTime(e){let t=new Date(e);return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}).format(t)}function googleSignout(){fetch("/signout",{method:"POST",headers:{App:"calendar"}}).then(e=>e.json()).then(e=>{e.signed_out&&(document.getElementById("authorize-button").style.display="inline",document.getElementById("signout-button").style.display="none",document.getElementById("main-title").textContent="",document.getElementById("refresh").style.display="none",document.getElementById("schedule-container").style.display="none",document.getElementById("calendar-link").style.display="none",document.getElementById("initial-view").style.display="block",clearInterval(refreshInterval),refreshInterval=null)})}function googleAuthorize(e){fetch("/authorize",{method:"GET",headers:{Check:e,App:"calendar"}}).then(e=>e.json()).then(e=>{document.getElementById("schedule-view").style.display="none",e.authorized?(document.getElementById("initial-view").style.display="none",renderSchedule(e.events),document.getElementById("user-email").textContent=e.user_email,document.getElementById("calendar-link").style.display="block",document.getElementById("authorize-button").style.display="none",document.getElementById("signout-button").style.display="inline",updateRefreshedAtTime(),document.getElementById("refresh").style.display="block",refreshInterval||(refreshInterval=setInterval(()=>{refresh("1","passive")},3e5))):(document.getElementById("authorize-button").style.display="inline",document.getElementById("signout-button").style.display="none")})}function updateScheduleDate(){let e=document.getElementById("schedule-date"),t=new Date,n=new Intl.DateTimeFormat("en-US",{month:"long",day:"numeric",year:"numeric"}).format(t);e.textContent=`- ${n} -`}function formatEventTime(e,t){let n=new Date(e),l=new Date(t),i=new Intl.DateTimeFormat("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}).format(n),d=new Intl.DateTimeFormat("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}).format(l),a=n.toDateString()===l.toDateString();if(a)return`${i} - ${d}`;{let r=new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(l);return`${i} - ${r}, ${d}`}}function renderSchedule(e){let t=document.getElementById("schedule-view");t.innerHTML="",updateScheduleDate();let n=e.filter(e=>!e.start.includes("T")),l=e.filter(e=>e.start.includes("T")),i=new Date;n.length>0&&n.forEach(e=>{let n=document.createElement("div");n.className="schedule-event all-day",n.innerHTML=`
                <div class="event-title">${e.title}</div>
                <div class="event-time">All Day</div>
            `,t.appendChild(n)}),l.length>0&&l.forEach(e=>{let n=document.createElement("div");n.className="schedule-event";let l=new Date(e.end);i>l&&n.classList.add("ended");let d=formatEventTime(e.start,e.end);n.innerHTML=`
                <div>${e.title}</div>
                <div class="event-time">${d}</div>
            `,t.appendChild(n)}),0===e.length&&(t.innerHTML='<div class="schedule-event">No events for today</div>'),t.style.display="block"}function refresh(e,t){let n=document.getElementById("schedule-view"),l=document.cookie.split("; ").some(e=>e.startsWith("access_token=")||e.startsWith("refresh_token="));"load"!==t||l?"active"===t&&(n.style.display="none"):(n.style.display="none",document.getElementById("initial-view").style.display="block"),googleAuthorize(e)}window.onload=function(){refresh("1","load")};