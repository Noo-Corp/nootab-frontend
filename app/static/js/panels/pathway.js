const goalTypes=["pathway-goals-ongoing","pathway-goals-current","pathway-goals-next","pathway-goals-short","pathway-goals-medium","pathway-goals-long","pathway-goals-past"],goalTypeHeaders={"pathway-goals-ongoing":"Ongoing","pathway-goals-current":"Current","pathway-goals-next":"Next","pathway-goals-short":"Short Term","pathway-goals-medium":"Medium Term","pathway-goals-long":"Long Term","pathway-goals-past":"Past"};function getUrlParams(){let e=new URLSearchParams(window.location.search);return{isPopped:e.get("popped")}}function loadGoals(){let{isPopped:e}=getUrlParams(),t=document.getElementById("goals-list");t.innerHTML="";let a=!1;if(("true"===e?goalTypes:["pathway-goals-ongoing","pathway-goals-current"]).forEach(l=>{let n=JSON.parse(localStorage.getItem(l))||[];if(0===n.length&&"true"!==e)return;a=a||n.length>0;let o=document.createElement("div");if(o.classList.add("goal-section"),o.classList.add(`${goalTypeHeaders[l].toLowerCase().replace(/\s+/g,"-")}`),"false"==e&&o.classList.add("glance-view"),"true"===e){let s=document.createElement("div");s.className="goal-section-header",s.classList.add(`${goalTypeHeaders[l].toLowerCase().replace(/\s+/g,"-")}`),s.innerHTML=`<span class="header-chevron">&#9660;</span> ${goalTypeHeaders[l]}`;let i=s.querySelector(".header-chevron");s.addEventListener("click",()=>{let e=o.querySelectorAll(".goal"),t=o.querySelector(".add-goal-container"),a=o.querySelector(".no-goals"),l="â–¶"==i.textContent;i.innerHTML=l?"&#9660;":"&#9654;",e.forEach(e=>{e.style.display=l?"flex":"none"}),t&&(t.style.display=l?"flex":"none"),a&&(a.style.display=l?"block":"none")}),o.appendChild(s)}if(0===n.length){let r=document.createElement("div");r.className="no-goals",r.textContent="(No goals yet)",o.appendChild(r)}else n.forEach((t,a)=>{let n=document.createElement("div");n.className="goal","false"==e&&n.classList.add("glance-view");let s=document.createElement("div");if(s.className="goal-title","true"===e){s.innerHTML=`<span class="editable-value title">${t.name}</span>`;let i=s.querySelector(".editable-value");i.contentEditable="true",i.addEventListener("blur",()=>{updateGoalField(l,a,"name",i.textContent.trim())}),i.addEventListener("keydown",e=>handleKeydown(e,l,a,"name",i))}else s.innerHTML=t.name;n.appendChild(s);let r=document.createElement("div");if(r.className="goal-category","true"===e){r.innerHTML=`<span class="editable-value">${t.category}</span>`;let d=r.querySelector(".editable-value");d.contentEditable="true",d.addEventListener("blur",()=>{updateGoalField(l,a,"category",d.textContent.trim())}),d.addEventListener("keydown",e=>handleKeydown(e,l,a,"category",d))}else r.innerHTML=`${t.category}`;if(n.appendChild(r),"true"===e){let p=document.createElement("div");p.className="goal-milestone",t.milestone?p.innerHTML=`<span class="editable-value">${t.milestone}</span>`:p.innerHTML='<span class="editable-value">_</span>';let g=p.querySelector(".editable-value");g.contentEditable="true",g.addEventListener("blur",()=>{updateGoalField(l,a,"milestone",g.textContent.trim())}),g.addEventListener("keydown",e=>handleKeydown(e,l,a,"milestone",g)),n.appendChild(p)}if("true"===e){let c=document.createElement("div");c.classList.add("goal-actions");let m=document.createElement("button");m.innerHTML="&#8613;",m.addEventListener("click",()=>promoteGoal(l,a)),c.appendChild(m);let u=document.createElement("button");u.innerHTML="&#8615;",u.addEventListener("click",()=>demoteGoal(l,a)),c.appendChild(u);let y=document.createElement("button");y.innerHTML="&#9745;",y.addEventListener("click",()=>completeGoal(l,a)),c.appendChild(y);let h=document.createElement("button");h.className="action-remove",h.innerHTML="&#10006;",h.addEventListener("click",()=>removeGoal(l,a)),c.appendChild(h),n.appendChild(c)}o.appendChild(n)});if("true"===e){let d=document.createElement("div");d.classList.add("add-goal-container");let p=document.createElement("input");p.type="text",p.className="flex-name-input",p.id=`goal-name-input-${l}`,p.placeholder="Goal Name";let g=document.createElement("input");g.type="text",g.className="flex-category-input",g.id=`goal-category-input-${l}`,g.placeholder="Category";let c=document.createElement("input");c.type="text",c.className="flex-milestone-input",c.id=`goal-milestone-input-${l}`,"pathway-goals-past"==l?c.placeholder="Result (Optional)":c.placeholder="Next Milestone (Optional)";let m=document.createElement("button");m.textContent="+",m.addEventListener("click",()=>{addGoal(l)}),d.appendChild(p),d.appendChild(g),d.appendChild(c),d.appendChild(m),o.appendChild(d)}t.appendChild(o)}),!a&&"false"==e){let l=document.createElement("div");l.className="no-goals-overall",l.innerHTML="No ongoing or current goals<br>Click <span>&#10063;</span> to add goals",t.appendChild(l)}}function addGoal(e){let t=document.getElementById(`goal-name-input-${e}`),a=document.getElementById(`goal-category-input-${e}`),l=document.getElementById(`goal-milestone-input-${e}`),n=t.value.trim(),o=a.value.trim(),s=l.value.trim();if(!n||!o){alert("Both Goal Name and Category are required to add a goal.");return}let i=JSON.parse(localStorage.getItem(e))||[];i.push({name:n,category:o,milestone:s||""}),localStorage.setItem(e,JSON.stringify(i)),t.value="",a.value="",l.value="",loadGoals()}function removeGoal(e,t){let a=JSON.parse(localStorage.getItem(e))||[];a.splice(t,1),localStorage.setItem(e,JSON.stringify(a)),loadGoals()}function promoteGoal(e,t){let a=goalTypes.indexOf(e);if(0==a)return;let l=JSON.parse(localStorage.getItem(e))||[],n=l.splice(t,1)[0];localStorage.setItem(e,JSON.stringify(l));let o=goalTypes[a-1],s=JSON.parse(localStorage.getItem(o))||[];s.push(n),localStorage.setItem(o,JSON.stringify(s)),loadGoals()}function demoteGoal(e,t){let a=goalTypes.indexOf(e);if(a==goalTypes.length-1)return;let l=JSON.parse(localStorage.getItem(e))||[],n=l.splice(t,1)[0];localStorage.setItem(e,JSON.stringify(l));let o;if(a===goalTypes.length-2){o="pathway-goals-past";let s=JSON.parse(localStorage.getItem(o))||[];s.unshift(n),localStorage.setItem(o,JSON.stringify(s))}else{o=goalTypes[a+1];let i=JSON.parse(localStorage.getItem(o))||[];i.push(n),localStorage.setItem(o,JSON.stringify(i))}loadGoals()}function completeGoal(e,t){if("pathway-goals-past"==e)return;let a=JSON.parse(localStorage.getItem(e))||[],l=a.splice(t,1)[0];localStorage.setItem(e,JSON.stringify(a));let n=JSON.parse(localStorage.getItem("pathway-goals-past"))||[];n.unshift(l),localStorage.setItem("pathway-goals-past",JSON.stringify(n)),loadGoals()}function updateGoalField(e,t,a,l){let n=JSON.parse(localStorage.getItem(e))||[];n[t]&&(n[t][a]=l,localStorage.setItem(e,JSON.stringify(n)),loadGoals())}function handleKeydown(e,t,a,l,n){("Enter"===e.key||"Escape"===e.key)&&updateGoalField(t,a,l,n.textContent.trim())}window.addEventListener("load",function(){loadGoals()});