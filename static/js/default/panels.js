function loadPanels(){let e=document.getElementById("panelContainer"),t=JSON.parse(localStorage.getItem("panel-order"))||[],l=JSON.parse(localStorage.getItem("flipped-panels"))||[];if(""==t){var n=document.createElement("div");n.textContent="+",n.classList.add("panel"),n.classList.add("empty"),n.onclick=toggleSidePanel,e.appendChild(n);return}e.innerHTML="",t.forEach((t,n)=>{var a=document.createElement("div"),s=document.createElement("div");s.classList.add("panel-number"),s.innerText=n+1,a.append(s),a.classList.add("panel");let r=document.createElement("iframe");if("blank"!=t.toLowerCase()?(r.src=`/templates/${t.toLowerCase()}.html?index=${n}&popped=false`,a.classList.add(t.toLowerCase())):a.classList.add("blank"),l[n]&&(r.style.display="none",panelFlipInitial(a,n)),r.style.visibility="hidden",r.onload=()=>onFrameLoad(r,!1),a.appendChild(r),"blank"!=t){let o=document.createElement("button");if(o.className="panel-privacy",o.onclick=function(e){panelFlip(e,this)},o.innerHTML="&#10551;",a.appendChild(o),!l[n]){let i=document.createElement("button");i.className="panel-popout",i.onclick=function(e){panelPopout(e,this)},i.innerHTML="&#10063;",a.appendChild(i)}}e.appendChild(a)});let a=document.getElementById("sidePanel"),s=a.classList.contains("open");if(s){let r=document.querySelectorAll(".panel.blank");r.forEach(e=>{e.style.borderColor="var(--backtext)"});let o=document.querySelectorAll(".panel-number");o.forEach(e=>{e.style.opacity=1,e.style.display="block"})}}function onFrameLoad(e,t=!1){e.style.visibility="visible",t&&e.parentNode.classList.remove("popout")}function toggleSidePanel(e){e.stopPropagation();let t=document.getElementById("sidePanel");t.classList.add("open");let l=document.querySelectorAll(".panel.blank");l.forEach(e=>{e.style.borderColor="var(--backtext)"});let n=document.querySelectorAll(".panel-number");n.forEach(e=>{e.style.opacity=1,e.style.display="block"}),document.getElementById("panelContainer").classList.add("panels-shifted"),document.getElementById("modalOverlay").classList.add("active","shifted")}function closePanel(e){let t=document.getElementById("sidePanel");e.preventDefault(),t.classList.remove("open");let l=document.querySelectorAll(".panel.blank");l.forEach(e=>{e.style.borderColor="transparent"});let n=document.querySelectorAll(".panel-number");n.forEach(e=>{e.style.opacity=0}),t.addEventListener("transitionend",()=>{t.classList.contains("open")||n.forEach(e=>{e.style.display="none"})}),document.getElementById("panelContainer").classList.remove("panels-shifted"),document.getElementById("modalOverlay").classList.remove("active","shifted")}function loadPanelOrderList(){let e=document.getElementById("panelOrderList"),t=JSON.parse(localStorage.getItem("panel-order"))||[];if(e.innerHTML="",0===t.length){let l=document.createElement("tr");l.id="empty-panel-order-tr";let n=document.createElement("td");n.id="empty-panel-order-td",n.textContent="NO PANELS",l.appendChild(n),e.appendChild(l);return}t.forEach((l,n)=>{let a=document.createElement("tr"),s=document.createElement("td"),r=document.createElement("input");r.value=n+1,r.className="orderInput",s.appendChild(r),a.appendChild(s),$(r).spinner({step:-1,min:1,max:t.length}).siblings(".ui-spinner-up, .ui-spinner-down").addClass("spinner-panel-button"),$(r).on("change",function(){let e=parseInt(this.value)-1;updatePanelOrder(n,e)}),$(r).on("keydown",function(e){if("ArrowUp"===e.key||"ArrowDown"===e.key){let t=parseInt(this.value)-1;updatePanelOrder(n,t)}});let o=document.createElement("td");o.innerText=l,o.classList.add("panel-name-cell"),a.appendChild(o);let i=document.createElement("td"),p=document.createElement("button");p.innerHTML="&#10006;",p.classList.add("panel-delete-button"),p.onclick=e=>deletePanel(e,n),i.appendChild(p),a.appendChild(i),e.appendChild(a)}),$(".spinner-panel-button").click(function(e){e.stopPropagation(),$(this).siblings("input").change()})}function updatePanelOrder(e,t){let l=JSON.parse(localStorage.getItem("panel-order"))||[],n=JSON.parse(localStorage.getItem("orders-note"))||[],a=JSON.parse(localStorage.getItem("orders-checklist"))||[],s=JSON.parse(localStorage.getItem("flipped-panels"))||[];if(t<0||t>=l.length||e===t)return;let r=l.splice(e,1)[0],o=n.splice(e,1)[0],i=a.splice(e,1)[0],p=s.splice(e,1)[0];l.splice(t,0,r),localStorage.setItem("panel-order",JSON.stringify(l)),n.splice(t,0,o),localStorage.setItem("orders-note",JSON.stringify(n)),a.splice(t,0,i),localStorage.setItem("orders-checklist",JSON.stringify(a)),s.splice(t,0,p),localStorage.setItem("flipped-panels",JSON.stringify(s)),loadPanels(),loadPanelOrderList()}function addToPanelOrder(e){let t=JSON.parse(localStorage.getItem("panel-order"))||[],l=JSON.parse(localStorage.getItem("orders-note"))||[],n=JSON.parse(localStorage.getItem("orders-checklist"))||[],a=JSON.parse(localStorage.getItem("flipped-panels"))||[];if(t.length<8){if(t.includes(e)&&["gmail","calendar","pathway","assets","trade"].includes(e))return;t.push(e),localStorage.setItem("panel-order",JSON.stringify(t)),l.push(null),localStorage.setItem("orders-note",JSON.stringify(l)),n.push(null),localStorage.setItem("orders-checklist",JSON.stringify(n)),a.push(!1),localStorage.setItem("flipped-panels",JSON.stringify(a)),loadPanels(),loadPanelOrderList()}}function deletePanel(e,t){e.stopPropagation();let l=JSON.parse(localStorage.getItem("panel-order"))||[],n=JSON.parse(localStorage.getItem("orders-note"))||[],a=JSON.parse(localStorage.getItem("orders-checklist"))||[],s=JSON.parse(localStorage.getItem("flipped-panels"))||[];1==l.length?(localStorage.removeItem("panel-order"),localStorage.removeItem("orders-note"),localStorage.removeItem("orders-checklist"),localStorage.removeItem("flipped-panels"),document.getElementById("panelContainer").innerHTML=""):(l.splice(t,1),localStorage.setItem("panel-order",JSON.stringify(l)),n.splice(t,1),localStorage.setItem("orders-note",JSON.stringify(n)),a.splice(t,1),localStorage.setItem("orders-checklist",JSON.stringify(a)),s.splice(t,1),localStorage.setItem("flipped-panels",JSON.stringify(s))),loadPanels(),loadPanelOrderList()}function clearPanelOrder(){localStorage.removeItem("panel-order"),localStorage.removeItem("orders-note"),localStorage.removeItem("orders-checklist"),localStorage.removeItem("flipped-panels"),document.getElementById("panelContainer").innerHTML="",loadPanels(),loadPanelOrderList()}function panelFlipInitial(e,t){let l=document.createElement("div");l.className="flip-text";let n=e.className.split(" ")[1];if("notes"===n){let a=JSON.parse(localStorage.getItem("orders-note")),s=JSON.parse(localStorage.getItem("vals-note")),r=s?.[a[t]-1]?.[0]??"Untitled";l.textContent=r}else if("checklist"===n){let o=JSON.parse(localStorage.getItem("orders-checklist")),i=JSON.parse(localStorage.getItem("vals-checklist")),p=i?.[o[t]-1]?.[0]??"Untitled";l.textContent=p}else l.textContent=n;e.style.backgroundColor="var(--modeback)",e.appendChild(l),e.classList.add("shifted");let d=e.querySelector(".panel-popout");d&&d.remove()}function panelFlip(e,t){e.stopPropagation();let l=t.closest(".panel"),n=Array.from(l.parentNode.children).indexOf(l),a=JSON.parse(localStorage.getItem("flipped-panels"))||[];for(;a.length<n+1;)a.push(!1);if(a[n]=!a[n],a[n])l.querySelector("iframe").style.display="none",l.classList.add("shifted"),panelFlipInitial(l,n);else{let s=l.querySelector("iframe");l.style.backgroundColor="var(--bodyback)";let r=l.querySelector(".flip-text");r&&r.remove(),s.style.display="block",s.src=s.src,l.classList.remove("shifted");let o=document.createElement("button");o.className="panel-popout",o.onclick=function(e){panelPopout(e,this)},o.innerHTML="&#10063;",l.appendChild(o)}localStorage.setItem("flipped-panels",JSON.stringify(a))}function panelPopout(e,t){e.stopPropagation();let l=document.querySelector(".panel.popout")||!1;if(l)closePopoutPanel();else{let n=t.closest(".panel");if(n){let a=n.querySelector("iframe");document.getElementById("modalOverlay").classList.add("active");let s=document.querySelectorAll(".panel");s.forEach(e=>{e!==n&&(e.style.display="none")}),t.innerHTML="&#9783;",t.classList.add("popped"),a.onload=()=>onFrameLoad(a,!1),a.src=a.src.replace(/([?&])popped=[^&]*/,"$1popped=true"),n.classList.add("popout"),n.querySelector(".panel-privacy").style.display="none"}}}function closePopoutPanel(){let e=document.querySelector(".panel.popout"),t=e.querySelector("iframe");t.src=e.querySelector("iframe").src.replace(/([?&])popped=[^&]*/,"$1popped=false"),t.onload=()=>onFrameLoad(t,!0);let l=document.querySelector(".panel-popout.popped");l.innerHTML="&#10063;",l.classList.remove("popped"),document.getElementById("modalOverlay").classList.remove("active");let n=document.querySelectorAll(".panel");n.forEach(e=>{e.style.display="flex"}),loadPanels()}window.addEventListener("load",()=>{loadPanels(),loadPanelOrderList()}),document.addEventListener("click",function(e){let t=document.querySelector(".panel.popout")||!1,l=document.getElementById("sidePanel"),n=l.classList.contains("open");if(n){let a=e.target.closest("#sidePanel");a||closePanel(e)}if(t){let s=e.target.closest(".panel.popout");s||closePopoutPanel()}}),document.addEventListener("keydown",function(e){let t=document.getElementById("sidePanel"),l=t.classList.contains("open");"Escape"===e.key&&l&&closePanel(e)});