(()=>{var t=Object.defineProperty,e=(e,i,o)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[i]=o,i=(t,i,o)=>(e(t,"symbol"!=typeof i?i+"":i,o),o),o=".colour-picker{position:relative}.button{width:4rem;height:4rem;padding:.25rem;background:none;border:none;cursor:pointer;box-sizing:border-box}.button-colour{display:block;width:100%;height:100%;box-shadow:0px 2px 4px 0px rgba(0,0,0,0.2);box-sizing:border-box;border-radius:8px;}",s=".popup{position:absolute;left:0%;top:calc(100% - 1px);z-index:50;box-shadow:0 4px 8px 0 rgba(0, 0, 0, 0.3), 0 8px 12px -2px rgba(0, 0, 0, 0.3);padding:.5rem;background:var(--modeback);border-width:1px;border-style:solid;border-color:var(--backtext);border-radius:.25rem}.popup.right{right:0;left:auto}",n=".saturation{touch-action:none;overflow:hidden;width:100%;height:8rem;position:relative}.box{width:100%;height:100%;position:absolute}.white{background:linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.black{background:linear-gradient(0,#000,transparent)}.pointer{top:34.902%;left:18.6747%;cursor:pointer;position:absolute;outline:0}.handler{box-shadow:0 0 0 1.5px #fff,inset 0 0 1px 1px rgb(0,0,0,0.3),0 0 1px 2px rgb(0,0,0,0.4);-webkit-transform:translate(-2px,-2px);transform:translate(-2px,-2px);border-radius:100%;width:.25rem;height:.25rem;outline:0}",h="tc-hsv-changed",r="tc-hue-changed",a="tc-button-clicked",u=t=>{t&&document.dispatchEvent(new CustomEvent(a,{detail:{cid:t}}))},l=(t,e,i,o)=>{t&&document.dispatchEvent(new CustomEvent(h,{detail:{h:e,s:i,v:o,cid:t}}))},d=(t,e)=>{t&&document.dispatchEvent(new CustomEvent(r,{detail:{h:e,cid:t}}))};function c(t,e){p(t)&&(t="100%");var i=g(t);return t=360===e?t:Math.min(e,Math.max(0,parseFloat(t))),i&&(t=parseInt(String(t*e),10)/100),1e-6>Math.abs(t-e)?1:t=360===e?(t<0?t%e+e:t%e)/parseFloat(String(e)):t%e/parseFloat(String(e))}function p(t){return"string"==typeof t&&-1!==t.indexOf(".")&&1===parseFloat(t)}function g(t){return"string"==typeof t&&-1!==t.indexOf("%")}function b(t){return(isNaN(t=parseFloat(t))||t<0||t>1)&&(t=1),t}function v(t){return t<=1?"".concat(100*Number(t),"%"):t}function $(t){return 1===t.length?"0"+t:String(t)}function m(t,e,i){return{r:255*c(t,255),g:255*c(e,255),b:255*c(i,255)}}function f(t,e,i){t=c(t,255),e=c(e,255),i=c(i,255);var o=Math.max(t,e,i),s=Math.min(t,e,i),n=0,h=0,r=(o+s)/2;if(o===s)h=0,n=0;else{var a=o-s;switch(h=r>.5?a/(2-o-s):a/(o+s),o){case t:n=(e-i)/a+(e<i?6:0);break;case e:n=(i-t)/a+2;break;case i:n=(t-e)/a+4}n/=6}return{h:n,s:h,l:r}}function x(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*(6*i):i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function w(t,e,i){var o,s,n;if(t=c(t,360),e=c(e,100),i=c(i,100),0===e)s=i,n=i,o=i;else{var h=i<.5?i*(1+e):i+e-i*e,r=2*i-h;o=x(r,h,t+1/3),s=x(r,h,t),n=x(r,h,t-1/3)}return{r:255*o,g:255*s,b:255*n}}function _(t,e,i){t=c(t,255),e=c(e,255),i=c(i,255);var o=Math.max(t,e,i),s=Math.min(t,e,i),n=0,h=o-s;if(o===s)n=0;else{switch(o){case t:n=(e-i)/h+(e<i?6:0);break;case e:n=(i-t)/h+2;break;case i:n=(t-e)/h+4}n/=6}return{h:n,s:0===o?0:h/o,v:o}}function y(t,e,i){t=6*c(t,360),e=c(e,100),i=c(i,100);var o=Math.floor(t),s=t-o,n=i*(1-e),h=i*(1-s*e),r=i*(1-(1-s)*e),a=o%6,u=[i,h,n,n,r,i][a],l=[r,i,i,h,n,n][a],d=[n,n,r,i,i,h][a];return{r:255*u,g:255*l,b:255*d}}function C(t,e,i,o){var s=[$(Math.round(t).toString(16)),$(Math.round(e).toString(16)),$(Math.round(i).toString(16))];return o&&s[0].startsWith(s[0].charAt(1))&&s[1].startsWith(s[1].charAt(1))&&s[2].startsWith(s[2].charAt(1))?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0):s.join("")}function k(t,e,i,o,s){var n=[$(Math.round(t).toString(16)),$(Math.round(e).toString(16)),$(Math.round(i).toString(16)),$(E(o))];return s&&n[0].startsWith(n[0].charAt(1))&&n[1].startsWith(n[1].charAt(1))&&n[2].startsWith(n[2].charAt(1))&&n[3].startsWith(n[3].charAt(1))?n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0)+n[3].charAt(0):n.join("")}function E(t){return Math.round(255*parseFloat(t)).toString(16)}function L(t){return A(t)/255}function A(t){return parseInt(t,16)}function S(t){return{r:t>>16,g:(65280&t)>>8,b:255&t}}function R(t){var e={r:0,g:0,b:0},i=1,o=null,s=null,n=null,h=!1,r=!1;return"string"==typeof t&&(t=F(t)),"object"==typeof t&&(U(t.r)&&U(t.g)&&U(t.b)?(e=m(t.r,t.g,t.b),h=!0,r="%"===String(t.r).substr(-1)?"prgb":"rgb"):U(t.h)&&U(t.s)&&U(t.v)?(o=v(t.s),s=v(t.v),e=y(t.h,o,s),h=!0,r="hsv"):U(t.h)&&U(t.s)&&U(t.l)&&(o=v(t.s),n=v(t.l),e=w(t.h,o,n),h=!0,r="hsl"),Object.prototype.hasOwnProperty.call(t,"a")&&(i=t.a)),i=b(i),{ok:h,format:t.format||r,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:i}}var D="[-\\+]?\\d+%?",P="[-\\+]?\\d*\\.\\d+%?",H="(?:".concat(P,")|(?:").concat(D,")"),B="[\\s|\\(]+(".concat(H,")[,|\\s]+(").concat(H,")[,|\\s]+(").concat(H,")\\s*\\)?"),K="[\\s|\\(]+(".concat(H,")[,|\\s]+(").concat(H,")[,|\\s]+(").concat(H,")[,|\\s]+(").concat(H,")\\s*\\)?"),M={CSS_UNIT:RegExp(H),rgb:RegExp("rgb"+B),rgba:RegExp("rgba"+K),hsl:RegExp("hsl"+B),hsla:RegExp("hsla"+K),hsv:RegExp("hsv"+B),hsva:RegExp("hsva"+K),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function F(t){if(0===(t=t.trim().toLowerCase()).length)return!1;var e=M.rgb.exec(t);return e?{r:e[1],g:e[2],b:e[3]}:(e=M.rgba.exec(t))?{r:e[1],g:e[2],b:e[3],a:e[4]}:(e=M.hsl.exec(t))?{h:e[1],s:e[2],l:e[3]}:(e=M.hsla.exec(t))?{h:e[1],s:e[2],l:e[3],a:e[4]}:(e=M.hsv.exec(t))?{h:e[1],s:e[2],v:e[3]}:(e=M.hsva.exec(t))?{h:e[1],s:e[2],v:e[3],a:e[4]}:(e=M.hex8.exec(t))?{r:A(e[1]),g:A(e[2]),b:A(e[3]),a:L(e[4]),format:"hex8"}:(e=M.hex6.exec(t))?{r:A(e[1]),g:A(e[2]),b:A(e[3]),format:"hex"}:(e=M.hex4.exec(t))?{r:A(e[1]+e[1]),g:A(e[2]+e[2]),b:A(e[3]+e[3]),a:L(e[4]+e[4]),format:"hex8"}:!!(e=M.hex3.exec(t))&&{r:A(e[1]+e[1]),g:A(e[2]+e[2]),b:A(e[3]+e[3]),format:"hex"}}function U(t){return Boolean(M.CSS_UNIT.exec(String(t)))}var z,V,q,T,W,G,I=function(){function t(e,i){if(void 0===e&&(e=""),void 0===i&&(i={}),e instanceof t)return e;"number"==typeof e&&(e=S(e)),this.originalInput=e;var o,s=R(e);this.originalInput=e,this.r=s.r,this.g=s.g,this.b=s.b,this.a=s.a,this.roundA=Math.round(100*this.a)/100,this.format=null!==(o=i.format)&&void 0!==o?o:s.format,this.gradientType=i.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=s.ok}return t.prototype.toHsv=function(){var t=_(this.r,this.g,this.b);return{h:360*t.h,s:t.s,v:t.v,a:this.a}},t.prototype.toHsvString=function(){var t=_(this.r,this.g,this.b),e=Math.round(360*t.h),i=Math.round(100*t.s),o=Math.round(100*t.v);return 1===this.a?"hsv(".concat(e,", ").concat(i,"%, ").concat(o,"%)"):"hsva(".concat(e,", ").concat(i,"%, ").concat(o,"%, ").concat(this.roundA,")")},t.prototype.toHsl=function(){var t=f(this.r,this.g,this.b);return{h:360*t.h,s:t.s,l:t.l,a:this.a}},t.prototype.toHslString=function(){var t=f(this.r,this.g,this.b),e=Math.round(360*t.h),i=Math.round(100*t.s),o=Math.round(100*t.l);return 1===this.a?"hsl(".concat(e,", ").concat(i,"%, ").concat(o,"%)"):"hsla(".concat(e,", ").concat(i,"%, ").concat(o,"%, ").concat(this.roundA,")")},t.prototype.toHex=function(t){return void 0===t&&(t=!1),C(this.r,this.g,this.b,t)},t.prototype.toHexString=function(t){return void 0===t&&(t=!1),"#"+this.toHex(t)},t.prototype.toHex8=function(t){return void 0===t&&(t=!1),k(this.r,this.g,this.b,this.a,t)},t.prototype.toHex8String=function(t){return void 0===t&&(t=!1),"#"+this.toHex8(t)},t.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},t.prototype.toRgbString=function(){var t=Math.round(this.r),e=Math.round(this.g),i=Math.round(this.b);return 1===this.a?"rgb(".concat(t,", ").concat(e,", ").concat(i,")"):"rgba(".concat(t,", ").concat(e,", ").concat(i,", ").concat(this.roundA,")")},t}(),O=()=>Math.random().toString(16).slice(2),X=t=>Math.round((t+Number.EPSILON)*100)/100,j=.01,N=t=>(t<0&&(t=0),t>360&&(t=360),`hsl(${Math.round(t)}, 100%, 50%)`),Y=t=>{let e=t.toRgb();return`rgba(${e.r}, ${e.g}, ${e.b}, ${X(e.a)})`},J=t=>(t<0&&(t=0),t>1&&(t=1),`${(-(100*t)+100).toFixed(2)}%`),Q=t=>(t<0&&(t=0),t>1&&(t=1),`${(100*t).toFixed(2)}%`),Z=t=>{t<0&&(t=0),t>360&&(t=360);let e=Math.round(100*(100*t/360))/100;return e<0&&(e=0),e>100&&(e=100),e},tt=t=>360*t/100,te=t=>{let e=Number(t)||0;return Math.min(255,e=Math.max(0,e=Math.round(e)))},ti=t=>new I(t||"#000"),to=class extends HTMLElement{constructor(){super(),i(this,"cid"),i(this,"$saturation"),i(this,"$color"),i(this,"$pointer"),i(this,"hue",0),i(this,"saturation",0),i(this,"value",0),this.attachShadow({mode:"open"}),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onChange=this.onChange.bind(this),this.onPointerKeyDown=this.onPointerKeyDown.bind(this),this.hsvChanged=this.hsvChanged.bind(this),this.hueChanged=this.hueChanged.bind(this)}static get observedAttributes(){return["color"]}render(t=!0){this.$pointer&&(this.$pointer.style.left=Q(this.saturation),this.$pointer.style.top=J(this.value)),this.$color&&this.$color.setAttribute("style",`background: ${N(this.hue)}`),t&&l(this.cid,this.hue,this.saturation,this.value)}onChange(t){if(!this.$saturation)return;let{width:e,height:i,left:o,top:s}=this.$saturation.getBoundingClientRect();if(0===e||0===i)return;let n="number"==typeof t.clientX?t.clientX:t.touches[0].clientX,h="number"==typeof t.clientY?t.clientY:t.touches[0].clientY;this.saturation=Math.min(Math.max(0,n-o),e)/e,this.value=1-Math.min(Math.max(0,h-s),i)/i,this.render()}onPointerKeyDown(t){switch(t.key){case"ArrowLeft":this.saturation=Math.max(0,this.saturation-j),this.render();break;case"ArrowRight":this.saturation=Math.min(1,this.saturation+j),this.render();break;case"ArrowUp":this.value=Math.min(1,this.value+j),this.render();break;case"ArrowDown":t.preventDefault(),this.value=Math.max(0,this.value-j),this.render()}}onMouseDown(t){t.preventDefault&&t.preventDefault(),this.onChange(t),window.addEventListener("mousemove",this.onChange),window.addEventListener("mouseup",this.onMouseUp),window.setTimeout(()=>{var t;null==(t=this.$pointer)||t.focus()},0)}onMouseUp(){window.removeEventListener("mousemove",this.onChange),window.removeEventListener("mouseup",this.onChange)}hsvChanged(t){if(!t||!t.detail||!t.detail.cid||t.detail.cid!==this.cid)return;let e=!1;this.hue!==t.detail.h&&(this.hue=t.detail.h,e=!0),this.saturation!==t.detail.s&&(this.saturation=t.detail.s,e=!0),this.value!==t.detail.v&&(this.value=t.detail.v,e=!0),e&&this.render(!1)}hueChanged(t){t&&t.detail&&t.detail.cid&&t.detail.cid===this.cid&&(this.hue=t.detail.h,this.render())}connectedCallback(){var t,e,i,o,s;if(!this.shadowRoot)return;this.cid=this.getAttribute("cid")||"";let a=ti(this.getAttribute("color")).toHsv();this.hue=a.h,this.saturation=a.s,this.value=a.v;let u=J(this.value),l=Q(this.saturation);this.shadowRoot.innerHTML=`
           <style>${n}</style>
           <div class="saturation">
                <div class="box" style="background: ${N(this.hue)}">
                    <div class="white box">
                        <div class="black box"></div>
                        
                        <div class="pointer" tabindex="0" style="top: ${u}; left: ${l};">
                            <div class="handler"></div>
                        </div>
                    </div>
                </div>
           </div>
        `,this.$saturation=this.shadowRoot.querySelector(".saturation"),this.$color=this.shadowRoot.querySelector(".box"),this.$pointer=this.shadowRoot.querySelector(".pointer"),null==(t=this.$pointer)||t.addEventListener("keydown",this.onPointerKeyDown),null==(e=this.$saturation)||e.addEventListener("mousedown",this.onMouseDown),null==(i=this.$saturation)||i.addEventListener("mouseup",this.onMouseUp),null==(o=this.$saturation)||o.addEventListener("touchmove",this.onChange),null==(s=this.$saturation)||s.addEventListener("touchstart",this.onChange),document.addEventListener(h,this.hsvChanged),document.addEventListener(r,this.hueChanged)}disconnectedCallback(){var t,e,i,o,s;null==(t=this.$saturation)||t.removeEventListener("mousedown",this.onMouseDown),null==(e=this.$saturation)||e.removeEventListener("mouseup",this.onMouseUp),null==(i=this.$saturation)||i.removeEventListener("touchmove",this.onChange),null==(o=this.$saturation)||o.removeEventListener("touchstart",this.onChange),null==(s=this.$pointer)||s.removeEventListener("keydown",this.onPointerKeyDown),document.removeEventListener(h,this.hsvChanged),document.removeEventListener(r,this.hueChanged)}attributeChangedCallback(t,e,i){let o=ti(i).toHsv();this.hue=o.h,this.saturation=o.s,this.value=o.v,this.render(!1)}},ts=".hue{overflow:hidden;height:.625rem;margin-bottom:.25rem;margin-top:.25rem;position:relative}.box{width:100%;height:100%;position:absolute}.hue-v{background:linear-gradient(0,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.hue-h{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red);width:100%;height:100%;position:relative}.pointer-box{left:87%;position:absolute;outline:0}.handler{background:#fff;box-shadow:0 0 2px rgb(0 0 0 / 60%);box-sizing:border-box;border:1px solid hsla(0,0%,88%,.5);height:8px;margin-top:1px;-webkit-transform:translateX(-4px);transform:translateX(-4px);width:8px;cursor:pointer;outline:0}.pointer-box:focus .handler{border:2px solid hsla(0,0%,88%,1)}",tn=class extends HTMLElement{constructor(){super(),i(this,"cid"),i(this,"$hue"),i(this,"$pointer"),i(this,"hue",0),this.attachShadow({mode:"open"}),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onChange=this.onChange.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.hsvChanged=this.hsvChanged.bind(this)}static get observedAttributes(){return["color"]}render(){this.$pointer&&(this.$pointer.style.left=`${Z(this.hue)}%`),d(this.cid,this.hue)}hsvChanged(t){t&&t.detail&&t.detail.cid&&t.detail.cid===this.cid&&this.hue!==t.detail.h&&(this.hue=t.detail.h,this.render())}onChange(t){if(!this.$hue)return;t.preventDefault&&t.preventDefault();let{width:e,left:i}=this.$hue.getBoundingClientRect();if(0===e)return;let o="number"==typeof t.clientX?t.clientX:t.touches[0].clientX;this.hue=tt(Math.min(Math.max(0,Math.round(100*Math.min(Math.max(0,o-i),e)/e)),100)),this.render()}onKeyDown(t){var e;switch(null==(e=this.$pointer)||e.focus(),t.key){case"ArrowLeft":{let i=Z(this.hue);i=Math.max(0,i-1),this.hue=tt(i),this.render();break}case"ArrowRight":{let o=Z(this.hue);o=Math.min(100,o+1),this.hue=tt(o),this.render()}}}onMouseDown(t){t.preventDefault&&t.preventDefault(),this.onChange(t),window.addEventListener("mousemove",this.onChange),window.addEventListener("mouseup",this.onMouseUp),window.setTimeout(()=>{var t;null==(t=this.$pointer)||t.focus()},0)}onMouseUp(){window.removeEventListener("mousemove",this.onChange),window.removeEventListener("mouseup",this.onChange)}connectedCallback(){var t,e,i,o,s;if(!this.shadowRoot)return;this.cid=this.getAttribute("cid")||"";let n=ti(this.getAttribute("color"));this.hue=n.toHsv().h,this.shadowRoot.innerHTML=`
           <style>${ts}</style>
           <div class="hue">
                <div class="box">
                    <div class="hue-v box">
                        <div class="hue-h"></div>
                    </div>
                    
                    <div class="pointer box">
                        <div class="pointer-box" tabindex="0" style="left: ${Z(this.hue)}%">
                            <div class="handler"></div>
                        </div>
                    </div>
                </div>
           </div>
        `,this.$hue=this.shadowRoot.querySelector(".hue"),this.$pointer=this.shadowRoot.querySelector(".pointer-box"),null==(t=this.$hue)||t.addEventListener("mousedown",this.onMouseDown),null==(e=this.$hue)||e.addEventListener("mouseup",this.onMouseUp),null==(i=this.$hue)||i.addEventListener("touchmove",this.onChange),null==(o=this.$hue)||o.addEventListener("touchstart",this.onChange),null==(s=this.$pointer)||s.addEventListener("keydown",this.onKeyDown),document.addEventListener(h,this.hsvChanged)}disconnectedCallback(){var t,e,i,o,s;null==(t=this.$hue)||t.removeEventListener("mousedown",this.onMouseDown),null==(e=this.$hue)||e.removeEventListener("mouseup",this.onMouseUp),null==(i=this.$hue)||i.removeEventListener("touchmove",this.onChange),null==(o=this.$hue)||o.removeEventListener("touchstart",this.onChange),null==(s=this.$pointer)||s.removeEventListener("keydown",this.onKeyDown),document.removeEventListener(h,this.hsvChanged)}attributeChangedCallback(t,e,i){let o=ti(i).toHsv();this.hue=o.h,this.render()}},th=".fields{font-size:11px;grid-template-columns:60px 35px 35px 35px;text-align:center;display:grid;gap:.25rem;margin-top:.25rem;color:var(--modetext)}.fields input{background:var(--modeback);border-width:1px;border-style:solid;border-color:var(--backtext);padding:1px 3px;border-radius:2px;color:var(--modetext);font-family:inherit;font-size:100%;line-height:inherit;margin:0;box-sizing:border-box}",tr=class extends HTMLElement{constructor(){super(),i(this,"cid"),i(this,"popupPosition","left"),i(this,"$popup"),i(this,"color","#000"),customElements.get("theme-colour-picker-saturation")||customElements.define("theme-colour-picker-saturation",to),customElements.get("theme-colour-picker-hue")||customElements.define("theme-colour-picker-hue",tn),customElements.get("theme-colour-picker-fields")||customElements.define("theme-colour-picker-fields",class extends HTMLElement{constructor(){super(),i(this,"cid"),i(this,"color",new I("#000")),i(this,"$hex"),i(this,"$r"),i(this,"$g"),i(this,"$b"),i(this,"hex",""),i(this,"r",0),i(this,"g",0),i(this,"b",0),i(this,"a",1),this.attachShadow({mode:"open"}),this.hsvChanged=this.hsvChanged.bind(this),this.hueChanged=this.hueChanged.bind(this),this.onHexChange=this.onHexChange.bind(this),this.render=this.render.bind(this),this.onRedChange=this.onRedChange.bind(this),this.onGreenChange=this.onGreenChange.bind(this),this.onBlueChange=this.onBlueChange.bind(this),this.onRedKeyDown=this.onRedKeyDown.bind(this),this.onBlueKeyDown=this.onBlueKeyDown.bind(this),this.onGreenKeyDown=this.onGreenKeyDown.bind(this)}static get observedAttributes(){return["color"]}hueChanged(t){if(!t||!t.detail||!t.detail.cid||t.detail.cid!==this.cid)return;let e=this.color.toHsv();this.color=new I({h:Number(t.detail.h),s:e.s,v:e.v,a:e.a}),this.render()}hsvChanged(t){t&&t.detail&&t.detail.cid&&t.detail.cid===this.cid&&(this.color=new I({h:t.detail.h,s:t.detail.s,v:t.detail.v,a:this.color.toHsv().a}),this.render())}render(){var t,e,i,o;let s=this.color.toRgb();this.r=s.r,this.g=s.g,this.b=s.b,this.a=s.a,this.hex=this.color.toHex(),this.$hex&&(null==(t=this.shadowRoot)?void 0:t.activeElement)!==this.$hex&&(this.$hex.value=this.hex.toUpperCase()),this.$r&&(null==(e=this.shadowRoot)?void 0:e.activeElement)!==this.$r&&(this.$r.value=this.r.toString()),this.$g&&(null==(i=this.shadowRoot)?void 0:i.activeElement)!==this.$g&&(this.$g.value=this.g.toString()),this.$b&&(null==(o=this.shadowRoot)?void 0:o.activeElement)!==this.$b&&(this.$b.value=this.b.toString())}onFieldKeyDown(t,e){var i,o;let s=this.color.toRgb();switch(t.key){case"ArrowUp":if("r"===e){this.r=Math.min(255,s.r+1),s.r=this.r;let n=new I(s).toHsv();l(this.cid,n.h,n.s,n.v),this.$r.value=this.r.toString(),this.render()}if("g"===e){this.g=Math.min(255,s.g+1),s.g=this.g;let h=new I(s).toHsv();l(this.cid,h.h,h.s,h.v),this.$g.value=this.g.toString(),this.render()}if("b"===e){this.b=Math.min(255,s.b+1),s.b=this.b;let r=new I(s).toHsv();l(this.cid,r.h,r.s,r.v),this.$b.value=this.b.toString(),this.render()}break;case"ArrowDown":if("r"===e){this.r=Math.max(0,s.r-1),s.r=this.r;let a=new I(s).toHsv();l(this.cid,a.h,a.s,a.v),this.$r.value=this.r.toString(),this.render()}if("g"===e){this.g=Math.max(0,s.g-1),s.g=this.g;let u=new I(s).toHsv();l(this.cid,u.h,u.s,u.v),this.$g.value=this.g.toString(),this.render()}if("b"===e){this.b=Math.max(0,s.b-1),s.b=this.b;let d=new I(s).toHsv();l(this.cid,d.h,d.s,d.v),this.$b.value=this.b.toString(),this.render()}break;case"Escape":null!=(i=this.shadowRoot)&&i.activeElement&&this.shadowRoot.activeElement.blur(),this.render();break;case"Enter":null!=(o=this.shadowRoot)&&o.activeElement&&this.shadowRoot.activeElement.blur(),this.render()}}onRedKeyDown(t){this.onFieldKeyDown(t,"r")}onGreenKeyDown(t){this.onFieldKeyDown(t,"g")}onBlueKeyDown(t){this.onFieldKeyDown(t,"b")}onHexChange(t){if("string"==typeof t){let e=new I(t);if(e.isValid){this.color=e;let i=this.color.toHsv();l(this.cid,i.h,i.s,i.v)}return}let o=t.target;if(6!==o.value.length)return;let s=new I(`#${o.value}`);if(s.isValid){this.color=s;let n=this.color.toHsv();l(this.cid,n.h,n.s,n.v)}}onRedChange(t){let e=t.target,i=te(e.value);if(i.toString()===e.value){let o=this.color.toRgb();o.r=i;let s=new I(o).toHsv();l(this.cid,s.h,s.s,s.v)}}onGreenChange(t){let e=t.target,i=te(e.value);if(i.toString()===e.value){let o=this.color.toRgb();o.g=i;let s=new I(o).toHsv();l(this.cid,s.h,s.s,s.v)}}onBlueChange(t){let e=t.target,i=te(e.value);if(i.toString()===e.value){let o=this.color.toRgb();o.b=i;let s=new I(o).toHsv();l(this.cid,s.h,s.s,s.v)}}hexToRgb(t){3===(t=t.replace("#","")).length&&(t=t.split("").map(t=>t+t).join(""));let e=parseInt(t.substring(0,2),16),i=parseInt(t.substring(2,4),16),o=parseInt(t.substring(4,6),16);return{r:e,g:i,b:o}}connectedCallback(){if(!this.shadowRoot)return;this.cid=this.getAttribute("cid")||"",this.color=ti(this.getAttribute("color"));let t=this.color.toRgb();this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this.hex=this.color.toHex();let e=O(),i=O(),o=O(),s=O();O();let n=this.offsetParent.offsetParent.parentNode.host.id,a="primary-colour-picker"==n?document.documentElement.style.getPropertyValue("--main"):document.documentElement.style.getPropertyValue("--secondary"),u=this.hexToRgb(a);this.shadowRoot.innerHTML=`
           <style>${th}</style>
           <div class="fields">
               <input id="hex-${e}" type="text" value="${this.hex.toUpperCase()}" data-type="hex" />
               <input id="r-${i}" type="text" value="${this.r}" data-type="r" />
               <input id="g-${o}" type="text" value="${this.g}" data-type="g" />
               <input id="b-${s}" type="text" value="${this.b}" data-type="b" />
               
               <label for="hex-${e}">Hex</label>
               <label for="r-${i}">R</label>
               <label for="g-${o}">G</label>
               <label for="b-${s}">B</label>
           </div>
        `,this.$hex=this.shadowRoot.getElementById(`hex-${e}`),this.$r=this.shadowRoot.getElementById(`r-${i}`),this.$g=this.shadowRoot.getElementById(`g-${o}`),this.$b=this.shadowRoot.getElementById(`b-${s}`),this.onHexChange(a),this.$hex.value=a.slice(1),this.$r.value=u.r,this.$g.value=u.g,this.$b.value=u.b,document.addEventListener(h,this.hsvChanged),document.addEventListener(r,this.hueChanged),this.$hex.addEventListener("input",this.onHexChange),this.$r.addEventListener("input",this.onRedChange),this.$g.addEventListener("input",this.onGreenChange),this.$b.addEventListener("input",this.onBlueChange),this.$hex.addEventListener("blur",this.render),this.$r.addEventListener("blur",this.render),this.$g.addEventListener("blur",this.render),this.$b.addEventListener("blur",this.render),this.$r.addEventListener("keydown",this.onRedKeyDown),this.$g.addEventListener("keydown",this.onGreenKeyDown),this.$b.addEventListener("keydown",this.onBlueKeyDown)}disconnectedCallback(){document.removeEventListener(h,this.hsvChanged),document.removeEventListener(r,this.hueChanged),this.$hex.removeEventListener("input",this.onHexChange),this.$r.removeEventListener("input",this.onRedChange),this.$g.removeEventListener("input",this.onGreenChange),this.$b.removeEventListener("input",this.onBlueChange),this.$hex.removeEventListener("blur",this.render),this.$r.removeEventListener("blur",this.render),this.$g.removeEventListener("blur",this.render),this.$b.removeEventListener("blur",this.render),this.$r.removeEventListener("keydown",this.onRedKeyDown),this.$g.removeEventListener("keydown",this.onGreenKeyDown),this.$b.removeEventListener("keydown",this.onBlueKeyDown)}attributeChangedCallback(t,e,i){this.color=ti(i),this.render()}}),this.cid=this.getAttribute("cid")||"",this.prevent=this.prevent.bind(this),this.attachShadow({mode:"open"})}static get observedAttributes(){return["color","popup-position"]}prevent(t){t.stopPropagation()}connectedCallback(){var t,e;this.shadowRoot&&(this.color=this.getAttribute("color")||"#000",this.popupPosition=this.getAttribute("popup-position")||"left",this.shadowRoot.innerHTML=`
           <style>${s}</style>
           <div class="popup">
                <theme-colour-picker-saturation color="${this.color}" cid="${this.cid}"></theme-colour-picker-saturation>
                <theme-colour-picker-hue color="${this.color}" cid="${this.cid}"></theme-colour-picker-hue>
                <theme-colour-picker-fields color="${this.color}" cid="${this.cid}"></theme-colour-picker-fields>
           </div>
        `,this.$popup=this.shadowRoot.querySelector(".popup"),null==(t=this.$popup)||t.addEventListener("mousedown",this.prevent),null==(e=this.$popup)||e.classList.toggle("right","right"===this.popupPosition))}disconnectedCallback(){var t;null==(t=this.$popup)||t.removeEventListener("mousedown",this.prevent)}attributeChangedCallback(t,e){var i,o,s;if("popup-position"===t&&(this.popupPosition=e,this.$popup&&this.$popup.classList.toggle("right","right"===this.popupPosition)),"color"===t){this.color=e;let n=null==(i=this.shadowRoot)?void 0:i.querySelector("theme-colour-picker-saturation"),h=null==(o=this.shadowRoot)?void 0:o.querySelector("theme-colour-picker-hue"),r=null==(s=this.shadowRoot)?void 0:s.querySelector("theme-colour-picker-fields");n&&n.setAttribute("color",this.color),h&&h.setAttribute("color",this.color),r&&r.setAttribute("color",this.color)}}},ta={sm:"0.875rem",md:"1.2rem",lg:"1.5rem",xl:"2.25rem","2xl":"3rem","3xl":"3.75rem","4xl":"4.5rem"},tu=class extends HTMLElement{constructor(){super(),i(this,"cid"),i(this,"$button"),i(this,"$buttonColour"),i(this,"$popupBox"),i(this,"stateDefaults",{isPopupVisible:!1,popupPosition:"left",initialColour:new I("#000"),color:new I("#000"),buttonWidth:null,buttonHeight:null,buttonPadding:null}),i(this,"state"),this.cid=O(),customElements.get("theme-colour-picker-popup")||customElements.define("theme-colour-picker-popup",tr),this.attachShadow({mode:"open"}),this.toggle=this.toggle.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.clickedOutside=this.clickedOutside.bind(this),this.stopPropagation=this.stopPropagation.bind(this),this.hsvChanged=this.hsvChanged.bind(this),this.hueChanged=this.hueChanged.bind(this),this.buttonClicked=this.buttonClicked.bind(this),this.formatButtonSize=this.formatButtonSize.bind(this),this.initState()}static get observedAttributes(){return["color","popup-position","button-width","button-height","button-padding"]}set color(t){this.state.color=new I(t)}get color(){return this.state.color}get hex(){return this.state.color.toHexString().toUpperCase()}initState(){let t=this;this.state=new Proxy(t.stateDefaults,{set:(e,i,o,s)=>(e[i]=o,"isPopupVisible"===i&&t.onPopupVisibilityChange(),"popupPosition"===i&&t.onPopupPosChange(),"initialColour"===i&&t.oninitialColourChange(),"color"===i&&t.onColourChange(),("buttonWidth"===i||"buttonHeight"===i||"buttonPadding"===i)&&t.setButtonSize(),!0)})}onPopupVisibilityChange(){this.$popupBox&&(this.$popupBox.innerHTML=this.state.isPopupVisible?`<theme-colour-picker-popup color="${this.state.color.toRgbString()}" cid="${this.cid}" popup-position="${this.state.popupPosition}" />`:"")}onPopupPosChange(){if(!this.$popupBox)return;let t=this.$popupBox.querySelector("theme-colour-picker-popup");t&&t.setAttribute("popup-position",this.state.popupPosition)}oninitialColourChange(){var t;let e=Y(this.state.color);this.$buttonColour&&(this.$buttonColour.style.backgroundColor=e);let i=null==(t=this.shadowRoot)?void 0:t.querySelector("theme-colour-picker-popup");i&&i.setAttribute("color",e)}setButtonSize(){!this.$button||(this.state.buttonWidth&&(this.$button.style.width=this.formatButtonSize(this.state.buttonWidth)),this.state.buttonHeight&&(this.$button.style.height=this.formatButtonSize(this.state.buttonHeight)),this.state.buttonPadding&&(this.$button.style.padding=this.state.buttonPadding))}onColourChange(){this.$buttonColour&&(this.$buttonColour.style.backgroundColor=Y(this.state.color)),this.dispatchEvent(new CustomEvent("change",{detail:{hex:this.hex,hex8:this.hex8,rgb:this.rgb,rgba:this.rgba,hsl:this.hsl,hsv:this.hsv,hsva:this.hsva,color:this.color}}))}hsvChanged(t){t&&t.detail&&t.detail.cid&&t.detail.cid===this.cid&&(this.state.color=new I({h:t.detail.h,s:t.detail.s,v:t.detail.v,a:this.state.color.toHsv().a}))}hueChanged(t){if(!t||!t.detail||!t.detail.cid||t.detail.cid!==this.cid)return;let e=this.state.color.toHsv();this.state.color=new I({h:t.detail.h,s:e.s,v:e.v,a:e.a})}buttonClicked(t){t&&t.detail&&t.detail.cid&&(t.detail.cid===this.cid||(this.state.isPopupVisible=!1))}clickedOutside(){this.state.isPopupVisible=!1}toggle(){let t=this.state.isPopupVisible;t||(this.state.isPopupVisible=!t,u(this.cid))}onKeyDown(t){"Escape"===t.key&&(this.state.isPopupVisible=!1)}stopPropagation(t){t.stopPropagation()}formatButtonSize(t){var e;return null!=(e=ta[t])?e:t}connectedCallback(){var t,e,i;this.shadowRoot&&(this.state.initialColour=ti(this.getAttribute("color")),this.state.color=ti(this.getAttribute("color")),this.state.popupPosition=this.getAttribute("popup-position")||"left",this.state.buttonWidth=this.getAttribute("button-width"),this.state.buttonHeight=this.getAttribute("button-height"),this.state.buttonPadding=this.getAttribute("button-padding"),this.shadowRoot.innerHTML=`
            <style>
                ${o} 
            </style>
            <div class="colour-picker" >
                <button
                    type="button"
                    tabIndex="0"
                    class="button"
                    title="Select Colour">
                    <span class="button-colour" style="background: ${Y(this.state.color)};"></span>
                </button>
                <div data-popup-box></div>
            </div>
        `,this.$button=this.shadowRoot.querySelector(".button"),this.$buttonColour=this.shadowRoot.querySelector(".button-colour"),null==(t=this.$button)||t.addEventListener("click",this.toggle),null==(e=this.$button)||e.addEventListener("keydown",this.onKeyDown),null==(i=this.$button)||i.addEventListener("mousedown",this.stopPropagation),this.$popupBox=this.shadowRoot.querySelector("[data-popup-box]"),this.setButtonSize(),document.addEventListener("mousedown",this.clickedOutside),document.addEventListener(h,this.hsvChanged),document.addEventListener(r,this.hueChanged),document.addEventListener(a,this.buttonClicked))}disconnectedCallback(){var t,e,i;null==(t=this.$button)||t.removeEventListener("click",this.toggle),null==(e=this.$button)||e.removeEventListener("keydown",this.onKeyDown),null==(i=this.$button)||i.removeEventListener("mousedown",this.stopPropagation),document.removeEventListener("mousedown",this.clickedOutside),document.removeEventListener(h,this.hsvChanged),document.removeEventListener(r,this.hueChanged),document.removeEventListener(a,this.buttonClicked)}attributeChangedCallback(t){switch(t){case"color":this.state.initialColour=ti(this.getAttribute("color")),this.state.color=ti(this.getAttribute("color")),this.oninitialColourChange();break;case"popup-position":this.state.popupPosition=this.getAttribute("popup-position")||"left",this.onPopupPosChange();break;case"button-width":this.state.buttonWidth=this.getAttribute("button-width"),this.setButtonSize();break;case"button-height":this.state.buttonHeight=this.getAttribute("button-height"),this.setButtonSize();break;case"button-padding":this.state.buttonPadding=this.getAttribute("button-padding"),this.setButtonSize()}}};customElements.get("theme-colour-picker")||customElements.define("theme-colour-picker",tu)})();