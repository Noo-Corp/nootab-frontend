function loadChecklist(){let{panelIndex:e}=getUrlParams(),t=JSON.parse(localStorage.getItem("vals-checklist"))||[],s=JSON.parse(localStorage.getItem("orders-checklist"))||Array(panelOrderLength),a=t[s[e]-1],l=document.getElementById("checklist-list"),i=document.getElementById("main-title");a?(l.innerHTML="",i.innerText=a[0]||"Untitled",Array.isArray(a[1])&&a[1].forEach((t,s)=>{let a=document.createElement("li");t.checked&&a.classList.add("checked"),t.focused&&a.classList.add("focused"),a.setAttribute("draggable",!0),a.dataset.index=s;let i=document.createElement("input");i.type="checkbox",i.checked=t.checked,i.addEventListener("change",()=>toggleTask(e,s));let r=document.createElement("span");r.textContent=t.text;let n=document.createElement("button");n.innerHTML="&#9678;",n.classList.add("focus-btn"),n.addEventListener("click",t=>{t.stopPropagation(),focusTask(e,s)});let c=document.createElement("button");c.innerHTML="&#10006;",c.classList.add("remove-btn"),c.addEventListener("click",t=>{t.stopPropagation(),removeTask(e,s)}),a.appendChild(i),a.appendChild(r),a.appendChild(n),a.appendChild(c),a.addEventListener("click",t=>{t.target!==i&&toggleTask(e,s)}),a.addEventListener("dragstart",e=>{e.dataTransfer.setData("text/plain",s),a.classList.add("dragging")}),a.addEventListener("dragend",()=>{a.classList.remove("dragging")}),a.addEventListener("dragover",e=>{e.preventDefault(),a.classList.remove("drag-over-from-above","drag-over-from-below");let t=parseInt(e.dataTransfer.getData("text/plain")),s=parseInt(a.dataset.index);t<s?a.classList.add("drag-over-from-above"):t>s&&a.classList.add("drag-over-from-below")}),a.addEventListener("dragleave",()=>{a.classList.remove("drag-over-from-above","drag-over-from-below")}),a.addEventListener("drop",t=>{t.preventDefault(),a.classList.remove("drag-over-from-above","drag-over-from-below");let s=parseInt(t.dataTransfer.getData("text/plain")),l=parseInt(a.dataset.index);s!==l&&reorderTasks(e,s,l)}),l.appendChild(a)})):i.innerText="Untitled";let{isPopped:r}=getUrlParams();"true"===r&&loadSidepanel("checklist")}function reorderTasks(e,t,s){let a=JSON.parse(localStorage.getItem("vals-checklist"))||[],l=JSON.parse(localStorage.getItem("orders-checklist"))||[],i=a[l[e]-1][1],[r]=i.splice(t,1);i.splice(s,0,r),a[l[e]-1][1]=i,localStorage.setItem("vals-checklist",JSON.stringify(a)),loadChecklist()}function updateTitle(e){let t=JSON.parse(localStorage.getItem("vals-checklist"))||[],s=JSON.parse(localStorage.getItem("orders-checklist")),a=document.getElementById("main-title");""!=(t?.[s?.[e]-1]||[])?t[s[e]-1][0]=a.innerText:(t.push([a.innerText,[]]),s[e]=t.length,localStorage.setItem("orders-checklist",JSON.stringify(s))),localStorage.setItem("vals-checklist",JSON.stringify(t));let{isPopped:l}=getUrlParams();"true"===l&&loadSidepanel("checklist")}function addTask(e){let t=JSON.parse(localStorage.getItem("vals-checklist"))||[],s=JSON.parse(localStorage.getItem("orders-checklist")),a=document.getElementById("main-title"),l=document.getElementById("checklist-input"),i=l.value.trim(),r=t?.[s[e]-1]?.[1]||[];""!=i&&r.push({text:i,checked:!1});""!=(t?.[s?.[e]-1]||[])?t[s[e]-1]=[a.innerText,r]:(t.push([a.innerText,r]),s[e]=t.length),l.value="",localStorage.setItem("vals-checklist",JSON.stringify(t)),localStorage.setItem("orders-checklist",JSON.stringify(s)),loadChecklist()}function focusTask(e,t){let s=JSON.parse(localStorage.getItem("vals-checklist"))||[],a=JSON.parse(localStorage.getItem("orders-checklist"))||[],l=s[a[e]-1][1],i=l[t];i.focused=!i.focused,l.splice(t,1),i.focused?l.unshift(i):l.push(i),s[a[e]-1][1]=l,localStorage.setItem("vals-checklist",JSON.stringify(s)),loadChecklist()}function removeTask(e,t){let s=JSON.parse(localStorage.getItem("vals-checklist")),a=JSON.parse(localStorage.getItem("orders-checklist"));s[a[e]-1][1].splice(t,1),localStorage.setItem("vals-checklist",JSON.stringify(s)),loadChecklist()}function toggleTask(e,t){let s=JSON.parse(localStorage.getItem("vals-checklist"))||[],a=JSON.parse(localStorage.getItem("orders-checklist"))||[];s[a[e]-1][1][t].checked=!s[a[e]-1][1][t].checked,localStorage.setItem("vals-checklist",JSON.stringify(s)),loadChecklist()}window.addEventListener("load",function(){let{panelIndex:e,isPopped:t}=getUrlParams();loadChecklist(),"true"===t&&loadSidepanel("checklist"),document.getElementById("main-title").addEventListener("input",()=>updateTitle(e)),document.getElementById("checklist-add-btn").addEventListener("click",()=>addTask(e)),document.getElementById("checklist-input").addEventListener("keydown",function(t){"Enter"===t.key?(t.preventDefault(),addTask(e)):"Escape"===t.key&&(t.preventDefault(),t.target.blur())})});