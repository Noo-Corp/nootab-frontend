function loadChecklist(){let{panelIndex:e}=getUrlParams(),t=JSON.parse(localStorage.getItem("vals-checklist"))||[],l=JSON.parse(localStorage.getItem("orders-checklist"))||Array(panelOrderLength),s=t[l[e]-1],i=document.getElementById("checklist-list"),c=document.getElementById("main-title");s?(i.innerHTML="",c.innerText=s[0]||"Untitled",Array.isArray(s[1])&&s[1].forEach((t,l)=>{let s=document.createElement("li");t.checked&&s.classList.add("checked");let c=document.createElement("input");c.type="checkbox",c.checked=t.checked,c.addEventListener("change",()=>toggleTask(e,l));let n=document.createElement("span");n.textContent=t.text;let a=document.createElement("button");a.innerHTML="&#10006;",a.classList.add("remove-btn"),a.addEventListener("click",t=>{t.stopPropagation(),removeTask(e,l)}),s.appendChild(c),s.appendChild(n),s.appendChild(a),s.addEventListener("click",t=>{t.target!==c&&toggleTask(e,l)}),i.appendChild(s)})):c.innerText="Untitled";let{isPopped:n}=getUrlParams();"true"===n&&loadSidepanel("checklist")}function updateTitle(e){let t=JSON.parse(localStorage.getItem("vals-checklist"))||[],l=JSON.parse(localStorage.getItem("orders-checklist")),s=document.getElementById("main-title");""!=(t?.[l?.[e]-1]||[])?t[l[e]-1][0]=s.innerText:(t.push([s.innerText,[]]),l[e]=t.length,localStorage.setItem("orders-checklist",JSON.stringify(l))),localStorage.setItem("vals-checklist",JSON.stringify(t));let{isPopped:i}=getUrlParams();"true"===i&&loadSidepanel("checklist")}function addTask(e){let t=JSON.parse(localStorage.getItem("vals-checklist"))||[],l=JSON.parse(localStorage.getItem("orders-checklist")),s=document.getElementById("main-title"),i=document.getElementById("checklist-input"),c=i.value.trim(),n=t?.[l[e]-1]?.[1]||[];""!=c&&n.push({text:c,checked:!1});""!=(t?.[l?.[e]-1]||[])?t[l[e]-1]=[s.innerText,n]:(t.push([s.innerText,n]),l[e]=t.length),i.value="",localStorage.setItem("vals-checklist",JSON.stringify(t)),localStorage.setItem("orders-checklist",JSON.stringify(l)),loadChecklist()}function removeTask(e,t){let l=JSON.parse(localStorage.getItem("vals-checklist")),s=JSON.parse(localStorage.getItem("orders-checklist"));l[s[e]-1][1].splice(t,1),localStorage.setItem("vals-checklist",JSON.stringify(l)),loadChecklist()}function toggleTask(e,t){let l=JSON.parse(localStorage.getItem("vals-checklist"))||[],s=JSON.parse(localStorage.getItem("orders-checklist"))||[];l[s[e]-1][1][t].checked=!l[s[e]-1][1][t].checked,localStorage.setItem("vals-checklist",JSON.stringify(l)),loadChecklist()}window.addEventListener("load",function(){let{panelIndex:e,isPopped:t}=getUrlParams();loadChecklist(),"true"===t&&loadSidepanel("checklist"),document.getElementById("main-title").addEventListener("input",()=>updateTitle(e)),document.getElementById("checklist-add-btn").addEventListener("click",()=>addTask(e)),document.getElementById("checklist-input").addEventListener("keydown",function(t){"Enter"===t.key?(t.preventDefault(),addTask(e)):"Escape"===t.key&&(t.preventDefault(),t.target.blur())})});