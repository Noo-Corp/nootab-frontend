function loadChecklist(){let{panelIndex:e}=getUrlParams(),t=JSON.parse(localStorage.getItem("vals-checklist"))||[],s=JSON.parse(localStorage.getItem("orders-checklist"))||Array(panelOrderLength),a=t[s[e]-1],i=document.getElementById("checklist-list"),l=document.getElementById("main-title");a?(i.innerHTML="",l.innerText=a[0]||"Untitled",Array.isArray(a[1])&&a[1].forEach((t,s)=>{let a=document.createElement("li");t.checked&&a.classList.add("checked"),t.focused&&a.classList.add("focused"),a.setAttribute("draggable",!0),a.dataset.index=s;let l=document.createElement("input");l.type="checkbox",l.checked=t.checked,l.addEventListener("change",()=>toggleTask(e,s));let c=document.createElement("span");c.textContent=t.text;let n=document.createElement("button");n.innerHTML="&#9678;",n.classList.add("focus-btn"),n.addEventListener("click",t=>{t.stopPropagation(),focusTask(e,s)});let d=document.createElement("button");d.innerHTML="&#10006;",d.classList.add("remove-btn"),d.addEventListener("click",t=>{t.stopPropagation(),removeTask(e,s)}),a.appendChild(l),a.appendChild(c),a.appendChild(n),a.appendChild(d),a.addEventListener("click",t=>{t.target!==l&&toggleTask(e,s)}),a.addEventListener("dragstart",e=>{e.dataTransfer.setData("text/plain",s),a.classList.add("dragging")}),a.addEventListener("dragend",()=>{a.classList.remove("dragging")}),a.addEventListener("dragover",e=>{e.preventDefault(),a.classList.add("drag-over")}),a.addEventListener("dragleave",()=>{a.classList.remove("drag-over")}),a.addEventListener("drop",t=>{t.preventDefault(),a.classList.remove("drag-over");let s=parseInt(t.dataTransfer.getData("text/plain")),i=parseInt(a.dataset.index);s!==i&&reorderTasks(e,s,i)}),i.appendChild(a)})):l.innerText="Untitled";let{isPopped:c}=getUrlParams();"true"===c&&loadSidepanel("checklist")}function reorderTasks(e,t,s){let a=JSON.parse(localStorage.getItem("vals-checklist"))||[],i=JSON.parse(localStorage.getItem("orders-checklist"))||[],l=a[i[e]-1][1],[c]=l.splice(t,1);l.splice(s,0,c),a[i[e]-1][1]=l,localStorage.setItem("vals-checklist",JSON.stringify(a)),loadChecklist()}function updateTitle(e){let t=JSON.parse(localStorage.getItem("vals-checklist"))||[],s=JSON.parse(localStorage.getItem("orders-checklist")),a=document.getElementById("main-title");""!=(t?.[s?.[e]-1]||[])?t[s[e]-1][0]=a.innerText:(t.push([a.innerText,[]]),s[e]=t.length,localStorage.setItem("orders-checklist",JSON.stringify(s))),localStorage.setItem("vals-checklist",JSON.stringify(t));let{isPopped:i}=getUrlParams();"true"===i&&loadSidepanel("checklist")}function addTask(e){let t=JSON.parse(localStorage.getItem("vals-checklist"))||[],s=JSON.parse(localStorage.getItem("orders-checklist")),a=document.getElementById("main-title"),i=document.getElementById("checklist-input"),l=i.value.trim(),c=t?.[s[e]-1]?.[1]||[];""!=l&&c.push({text:l,checked:!1});""!=(t?.[s?.[e]-1]||[])?t[s[e]-1]=[a.innerText,c]:(t.push([a.innerText,c]),s[e]=t.length),i.value="",localStorage.setItem("vals-checklist",JSON.stringify(t)),localStorage.setItem("orders-checklist",JSON.stringify(s)),loadChecklist()}function focusTask(e,t){let s=JSON.parse(localStorage.getItem("vals-checklist"))||[],a=JSON.parse(localStorage.getItem("orders-checklist"))||[],i=s[a[e]-1][1],l=i[t];l.focused=!l.focused,i.splice(t,1),l.focused?i.unshift(l):i.push(l),s[a[e]-1][1]=i,localStorage.setItem("vals-checklist",JSON.stringify(s)),loadChecklist()}function removeTask(e,t){let s=JSON.parse(localStorage.getItem("vals-checklist")),a=JSON.parse(localStorage.getItem("orders-checklist"));s[a[e]-1][1].splice(t,1),localStorage.setItem("vals-checklist",JSON.stringify(s)),loadChecklist()}function toggleTask(e,t){let s=JSON.parse(localStorage.getItem("vals-checklist"))||[],a=JSON.parse(localStorage.getItem("orders-checklist"))||[];s[a[e]-1][1][t].checked=!s[a[e]-1][1][t].checked,localStorage.setItem("vals-checklist",JSON.stringify(s)),loadChecklist()}window.addEventListener("load",function(){let{panelIndex:e,isPopped:t}=getUrlParams();loadChecklist(),"true"===t&&loadSidepanel("checklist"),document.getElementById("main-title").addEventListener("input",()=>updateTitle(e)),document.getElementById("checklist-add-btn").addEventListener("click",()=>addTask(e)),document.getElementById("checklist-input").addEventListener("keydown",function(t){"Enter"===t.key?(t.preventDefault(),addTask(e)):"Escape"===t.key&&(t.preventDefault(),t.target.blur())})});