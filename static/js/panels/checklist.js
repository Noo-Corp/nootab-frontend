function loadChecklist(){let{panelIndex:e}=getUrlParams(),t=JSON.parse(localStorage.getItem("vals-checklist"))||[],s=JSON.parse(localStorage.getItem("orders-checklist"))||Array(panelOrderLength),l=t[s[e]-1],c=document.getElementById("checklist-list"),i=document.getElementById("main-title");l?(c.innerHTML="",i.innerText=l[0]||"Untitled",Array.isArray(l[1])&&l[1].forEach((t,s)=>{let l=document.createElement("li");t.checked&&l.classList.add("checked"),t.focused&&l.classList.add("focused");let i=document.createElement("input");i.type="checkbox",i.checked=t.checked,i.addEventListener("change",()=>toggleTask(e,s));let n=document.createElement("span");n.textContent=t.text;let a=document.createElement("button");a.innerHTML="&#9678;",a.classList.add("priority-btn"),a.addEventListener("click",t=>{t.stopPropagation(),focusTask(e,s)});let d=document.createElement("button");d.innerHTML="&#10006;",d.classList.add("remove-btn"),d.addEventListener("click",t=>{t.stopPropagation(),removeTask(e,s)}),l.appendChild(i),l.appendChild(n),l.appendChild(a),l.appendChild(d),l.addEventListener("click",t=>{t.target!==i&&toggleTask(e,s)}),c.appendChild(l)})):i.innerText="Untitled";let{isPopped:n}=getUrlParams();"true"===n&&loadSidepanel("checklist")}function updateTitle(e){let t=JSON.parse(localStorage.getItem("vals-checklist"))||[],s=JSON.parse(localStorage.getItem("orders-checklist")),l=document.getElementById("main-title");""!=(t?.[s?.[e]-1]||[])?t[s[e]-1][0]=l.innerText:(t.push([l.innerText,[]]),s[e]=t.length,localStorage.setItem("orders-checklist",JSON.stringify(s))),localStorage.setItem("vals-checklist",JSON.stringify(t));let{isPopped:c}=getUrlParams();"true"===c&&loadSidepanel("checklist")}function addTask(e){let t=JSON.parse(localStorage.getItem("vals-checklist"))||[],s=JSON.parse(localStorage.getItem("orders-checklist")),l=document.getElementById("main-title"),c=document.getElementById("checklist-input"),i=c.value.trim(),n=t?.[s[e]-1]?.[1]||[];""!=i&&n.push({text:i,checked:!1});""!=(t?.[s?.[e]-1]||[])?t[s[e]-1]=[l.innerText,n]:(t.push([l.innerText,n]),s[e]=t.length),c.value="",localStorage.setItem("vals-checklist",JSON.stringify(t)),localStorage.setItem("orders-checklist",JSON.stringify(s)),loadChecklist()}function focusTask(e,t){let s=JSON.parse(localStorage.getItem("vals-checklist"))||[],l=JSON.parse(localStorage.getItem("orders-checklist"))||[],c=s[l[e]-1][1],i=c[t];i.focused=!i.focused,c.splice(t,1),i.focused?c.unshift(i):c.push(i),s[l[e]-1][1]=c,localStorage.setItem("vals-checklist",JSON.stringify(s)),loadChecklist()}function removeTask(e,t){let s=JSON.parse(localStorage.getItem("vals-checklist")),l=JSON.parse(localStorage.getItem("orders-checklist"));s[l[e]-1][1].splice(t,1),localStorage.setItem("vals-checklist",JSON.stringify(s)),loadChecklist()}function toggleTask(e,t){let s=JSON.parse(localStorage.getItem("vals-checklist"))||[],l=JSON.parse(localStorage.getItem("orders-checklist"))||[];s[l[e]-1][1][t].checked=!s[l[e]-1][1][t].checked,localStorage.setItem("vals-checklist",JSON.stringify(s)),loadChecklist()}window.addEventListener("load",function(){let{panelIndex:e,isPopped:t}=getUrlParams();loadChecklist(),"true"===t&&loadSidepanel("checklist"),document.getElementById("main-title").addEventListener("input",()=>updateTitle(e)),document.getElementById("checklist-add-btn").addEventListener("click",()=>addTask(e)),document.getElementById("checklist-input").addEventListener("keydown",function(t){"Enter"===t.key?(t.preventDefault(),addTask(e)):"Escape"===t.key&&(t.preventDefault(),t.target.blur())})});