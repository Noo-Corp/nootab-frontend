function loadChecklist(){let{panelIndex:e}=getUrlParams(),t=JSON.parse(localStorage.getItem("vals-checklist"))||[],s=JSON.parse(localStorage.getItem("orders-checklist"))||Array(panelOrderLength),c=t[s[e]-1],l=document.getElementById("checklist-list"),i=document.getElementById("main-title");c?(l.innerHTML="",i.innerText=c[0]||"Untitled",Array.isArray(c[1])&&c[1].forEach((t,s)=>{let c=document.createElement("li");t.checked&&c.classList.add("checked"),t.focused&&c.classList.add("focused");let i=document.createElement("input");i.type="checkbox",i.checked=t.checked,i.addEventListener("change",()=>toggleTask(e,s));let n=document.createElement("span");n.textContent=t.text;let a=document.createElement("button");a.innerHTML="&#9678;",a.classList.add("focus-btn"),a.addEventListener("click",t=>{t.stopPropagation(),focusTask(e,s)});let d=document.createElement("button");d.innerHTML="&#10006;",d.classList.add("remove-btn"),d.addEventListener("click",t=>{t.stopPropagation(),removeTask(e,s)}),c.appendChild(i),c.appendChild(n),c.appendChild(a),c.appendChild(d),c.addEventListener("click",t=>{t.target!==i&&toggleTask(e,s)}),l.appendChild(c)})):i.innerText="Untitled";let{isPopped:n}=getUrlParams();"true"===n&&loadSidepanel("checklist")}function updateTitle(e){let t=JSON.parse(localStorage.getItem("vals-checklist"))||[],s=JSON.parse(localStorage.getItem("orders-checklist")),c=document.getElementById("main-title");""!=(t?.[s?.[e]-1]||[])?t[s[e]-1][0]=c.innerText:(t.push([c.innerText,[]]),s[e]=t.length,localStorage.setItem("orders-checklist",JSON.stringify(s))),localStorage.setItem("vals-checklist",JSON.stringify(t));let{isPopped:l}=getUrlParams();"true"===l&&loadSidepanel("checklist")}function addTask(e){let t=JSON.parse(localStorage.getItem("vals-checklist"))||[],s=JSON.parse(localStorage.getItem("orders-checklist")),c=document.getElementById("main-title"),l=document.getElementById("checklist-input"),i=l.value.trim(),n=t?.[s[e]-1]?.[1]||[];""!=i&&n.push({text:i,checked:!1});""!=(t?.[s?.[e]-1]||[])?t[s[e]-1]=[c.innerText,n]:(t.push([c.innerText,n]),s[e]=t.length),l.value="",localStorage.setItem("vals-checklist",JSON.stringify(t)),localStorage.setItem("orders-checklist",JSON.stringify(s)),loadChecklist()}function focusTask(e,t){let s=JSON.parse(localStorage.getItem("vals-checklist"))||[],c=JSON.parse(localStorage.getItem("orders-checklist"))||[],l=s[c[e]-1][1],i=l[t];i.focused=!i.focused,l.splice(t,1),i.focused?l.unshift(i):l.push(i),s[c[e]-1][1]=l,localStorage.setItem("vals-checklist",JSON.stringify(s)),loadChecklist()}function removeTask(e,t){let s=JSON.parse(localStorage.getItem("vals-checklist")),c=JSON.parse(localStorage.getItem("orders-checklist"));s[c[e]-1][1].splice(t,1),localStorage.setItem("vals-checklist",JSON.stringify(s)),loadChecklist()}function toggleTask(e,t){let s=JSON.parse(localStorage.getItem("vals-checklist"))||[],c=JSON.parse(localStorage.getItem("orders-checklist"))||[];s[c[e]-1][1][t].checked=!s[c[e]-1][1][t].checked,localStorage.setItem("vals-checklist",JSON.stringify(s)),loadChecklist()}window.addEventListener("load",function(){let{panelIndex:e,isPopped:t}=getUrlParams();loadChecklist(),"true"===t&&loadSidepanel("checklist"),document.getElementById("main-title").addEventListener("input",()=>updateTitle(e)),document.getElementById("checklist-add-btn").addEventListener("click",()=>addTask(e)),document.getElementById("checklist-input").addEventListener("keydown",function(t){"Enter"===t.key?(t.preventDefault(),addTask(e)):"Escape"===t.key&&(t.preventDefault(),t.target.blur())})});