const goalTypes=["pathway-goals-ongoing","pathway-goals-current","pathway-goals-next","pathway-goals-short","pathway-goals-medium","pathway-goals-long","pathway-goals-past"],goalTypeHeaders={"pathway-goals-ongoing":"Ongoing","pathway-goals-current":"Current","pathway-goals-next":"Next","pathway-goals-short":"Short Term","pathway-goals-medium":"Medium Term","pathway-goals-long":"Long Term","pathway-goals-past":"Past"};function goalStart(){document.getElementById("main-title").classList.add("current-title"),document.getElementById("bingo-title").classList.remove("current-title"),document.getElementById("main-container").style.height="calc(100% - 60px)",document.getElementById("title-container").style.borderTop="2px solid var(--modeback)",loadGoals()}function bingoStart(){document.getElementById("main-title").classList.remove("current-title"),document.getElementById("bingo-title").classList.add("current-title"),document.getElementById("main-container").style.height="calc(100% - 45px)",document.getElementById("title-container").style.borderTop="none",loadBingo()}function getUrlParams(){let e=new URLSearchParams(window.location.search);return{isPopped:e.get("popped")}}function setView(e){localStorage.setItem("pathway-view",e),"pathway"===e?goalStart():"bingo"===e&&bingoStart()}function loadBingo(){let e=document.getElementById("goals-list");e.innerHTML="";let t=JSON.parse(localStorage.getItem("bingo-data"))||{checked:[,,,,,].fill().map(()=>[,,,,,].fill(!1)),texts:[,,,,,].fill().map(()=>[,,,,,].fill("..."))},a=document.createElement("table");a.classList.add("bingo-table");for(let l=0;l<5;l++){let n=document.createElement("tr");for(let i=0;i<5;i++){let o=document.createElement("td");o.classList.add("bingo-cell"),o.dataset.row=l,o.dataset.col=i;let s=document.createElement("span");s.classList.add("bingo-text"),s.textContent=t.texts[l][i],s.contentEditable=!0,s.spellcheck=!1,2===l&&2===i&&(s.textContent="Free",s.contentEditable=!1,o.classList.add("checked","checked-free"),t.checked[l][i]=!0),s.addEventListener("click",function(e){e.stopPropagation()}),s.addEventListener("input",function(){t.texts[l][i]=this.textContent,localStorage.setItem("bingo-data",JSON.stringify(t))}),o.addEventListener("click",function(e){if(2!==l||2!==i){if(t.checked[l][i]=!t.checked[l][i],localStorage.setItem("bingo-data",JSON.stringify(t)),!this.classList.contains("checked")){let a=e.clientX/window.innerWidth,n=e.clientY/window.innerHeight;confetti({particleCount:40,spread:40,origin:{x:a,y:n},startVelocity:28}),makesBingo(t.checked,l,i)&&bingoConfetti(t.checked)}this.classList.toggle("checked"),checkBingo(t.checked)}}),t.checked[l][i]&&o.classList.add("checked"),o.appendChild(s),n.appendChild(o)}a.appendChild(n)}e.appendChild(a),checkBingo(t.checked)}function makesBingo(e,t,a){let l=e.map(e=>[...e]),n=countBingos(l);l[t][a]=!1;let i=countBingos(l);return n>i}function countBingos(e){let t=0;for(let a=0;a<5;a++)e[a].every(e=>e)&&t++,e.map(e=>e[a]).every(e=>e)&&t++;return e.map((e,t)=>e[t]).every(e=>e)&&t++,e.map((e,t)=>e[4-t]).every(e=>e)&&t++,t}function checkBingo(e){0==(bingoCount=countBingos(e))?document.querySelector(".bingo-cell.checked.checked-free").innerText="FREE":1==bingoCount?document.querySelector(".bingo-cell.checked.checked-free").innerText="BINGO":12==bingoCount?document.querySelector(".bingo-cell.checked.checked-free").innerText="FULL BINGO":document.querySelector(".bingo-cell.checked.checked-free").innerText="BINGO x"+bingoCount}function bingoConfetti(e){if((bingoCount=countBingos(e))<12){var t=Date.now()+1e3;!function e(){confetti({particleCount:7,angle:60,spread:55,origin:{x:0}}),confetti({particleCount:7,angle:120,spread:55,origin:{x:1}}),Date.now()<t&&requestAnimationFrame(e)}()}else{var a={spread:360,ticks:50,gravity:0,decay:.9,startVelocity:15,colors:["FFE400","FFBD00","E89400","FFCA6C","FDFFB8"]};function l(){confetti({...a,particleCount:40,scalar:1.2,shapes:["star"]}),confetti({...a,particleCount:10,scalar:.75,shapes:["circle"]})}setTimeout(l,0),setTimeout(l,100),setTimeout(l,200)}}function loadGoals(){let{isPopped:e}=getUrlParams(),t=document.getElementById("goals-list");t.innerHTML="";let a=!1;if(("true"===e?goalTypes:["pathway-goals-ongoing","pathway-goals-current"]).forEach(l=>{let n=JSON.parse(localStorage.getItem(l))||[];if(0===n.length&&"true"!==e)return;a=a||n.length>0;let i=document.createElement("div");if(i.classList.add("goal-section"),i.classList.add(`${goalTypeHeaders[l].toLowerCase().replace(/\s+/g,"-")}`),"false"==e&&i.classList.add("glance-view"),"true"===e){let o=document.createElement("div");o.className="goal-section-header",o.classList.add(`${goalTypeHeaders[l].toLowerCase().replace(/\s+/g,"-")}`),o.innerHTML=`<span class="header-chevron">&#9660;</span> ${goalTypeHeaders[l]}`;let s=o.querySelector(".header-chevron");o.addEventListener("click",()=>{let e=i.querySelectorAll(".goal"),t=i.querySelector(".add-goal-container"),a=i.querySelector(".no-goals"),l="â–¶"==s.textContent;s.innerHTML=l?"&#9660;":"&#9654;",e.forEach(e=>{e.style.display=l?"flex":"none"}),t&&(t.style.display=l?"flex":"none"),a&&(a.style.display=l?"block":"none")}),i.appendChild(o)}if(0===n.length){let r=document.createElement("div");r.className="no-goals",r.textContent="(No goals yet)",i.appendChild(r)}else n.forEach((t,a)=>{let n=document.createElement("div");n.className="goal","false"==e&&n.classList.add("glance-view");let o=document.createElement("div");if(o.className="goal-title","true"===e){o.innerHTML=`<span class="editable-value title">${t.name}</span>`;let s=o.querySelector(".editable-value");s.contentEditable="true",s.addEventListener("blur",()=>{updateGoalField(l,a,"name",s.textContent.trim())}),s.addEventListener("keydown",e=>handleKeydown(e,l,a,"name",s))}else o.innerHTML=t.name;n.appendChild(o);let r=document.createElement("div");if(r.className="goal-category","true"===e){r.innerHTML=`<span class="editable-value">${t.category}</span>`;let d=r.querySelector(".editable-value");d.contentEditable="true",d.addEventListener("blur",()=>{updateGoalField(l,a,"category",d.textContent.trim())}),d.addEventListener("keydown",e=>handleKeydown(e,l,a,"category",d))}else r.innerHTML=`${t.category}`;if(n.appendChild(r),"true"===e){let c=document.createElement("div");c.className="goal-milestone",t.milestone?c.innerHTML=`<span class="editable-value">${t.milestone}</span>`:c.innerHTML='<span class="editable-value">_</span>';let p=c.querySelector(".editable-value");p.contentEditable="true",p.addEventListener("blur",()=>{updateGoalField(l,a,"milestone",p.textContent.trim())}),p.addEventListener("keydown",e=>handleKeydown(e,l,a,"milestone",p)),n.appendChild(c)}if("true"===e){let g=document.createElement("div");g.classList.add("goal-actions");let m=document.createElement("button");m.innerHTML="&#8613;",m.addEventListener("click",()=>promoteGoal(l,a)),g.appendChild(m);let u=document.createElement("button");u.innerHTML="&#8615;",u.addEventListener("click",()=>demoteGoal(l,a)),g.appendChild(u);let y=document.createElement("button");y.innerHTML="&#9745;",y.addEventListener("click",()=>completeGoal(l,a)),g.appendChild(y);let h=document.createElement("button");h.className="action-remove",h.innerHTML="&#10006;",h.addEventListener("click",()=>removeGoal(l,a)),g.appendChild(h),n.appendChild(g)}i.appendChild(n)});if("true"===e){let d=document.createElement("div");d.classList.add("add-goal-container");let c=document.createElement("input");c.type="text",c.className="flex-name-input",c.id=`goal-name-input-${l}`,c.placeholder="Goal Name";let p=document.createElement("input");p.type="text",p.className="flex-category-input",p.id=`goal-category-input-${l}`,p.placeholder="Category";let g=document.createElement("input");g.type="text",g.className="flex-milestone-input",g.id=`goal-milestone-input-${l}`,"pathway-goals-past"==l?g.placeholder="Result (Optional)":g.placeholder="Next Milestone (Optional)";let m=document.createElement("button");m.textContent="+",m.addEventListener("click",()=>{addGoal(l)}),d.appendChild(c),d.appendChild(p),d.appendChild(g),d.appendChild(m),i.appendChild(d)}t.appendChild(i)}),!a&&"false"==e){let l=document.createElement("div");l.className="no-goals-overall",l.innerHTML="No ongoing or current goals<br>Click <span>&#10063;</span> to add goals",t.appendChild(l)}}function addGoal(e){let t=document.getElementById(`goal-name-input-${e}`),a=document.getElementById(`goal-category-input-${e}`),l=document.getElementById(`goal-milestone-input-${e}`),n=t.value.trim(),i=a.value.trim(),o=l.value.trim();if(!n||!i){alert("Both Goal Name and Category are required to add a goal.");return}let s=JSON.parse(localStorage.getItem(e))||[];s.push({name:n,category:i,milestone:o||""}),localStorage.setItem(e,JSON.stringify(s)),t.value="",a.value="",l.value="",loadGoals()}function removeGoal(e,t){let a=JSON.parse(localStorage.getItem(e))||[];a.splice(t,1),localStorage.setItem(e,JSON.stringify(a)),loadGoals()}function promoteGoal(e,t){let a=goalTypes.indexOf(e);if(0==a)return;let l=JSON.parse(localStorage.getItem(e))||[],n=l.splice(t,1)[0];localStorage.setItem(e,JSON.stringify(l));let i=goalTypes[a-1],o=JSON.parse(localStorage.getItem(i))||[];o.push(n),localStorage.setItem(i,JSON.stringify(o)),loadGoals()}function demoteGoal(e,t){let a=goalTypes.indexOf(e);if(a==goalTypes.length-1)return;let l=JSON.parse(localStorage.getItem(e))||[],n=l.splice(t,1)[0];localStorage.setItem(e,JSON.stringify(l));let i;if(a===goalTypes.length-2){i="pathway-goals-past";let o=JSON.parse(localStorage.getItem(i))||[];o.unshift(n),localStorage.setItem(i,JSON.stringify(o))}else{i=goalTypes[a+1];let s=JSON.parse(localStorage.getItem(i))||[];s.push(n),localStorage.setItem(i,JSON.stringify(s))}loadGoals()}function completeGoal(e,t){if("pathway-goals-past"==e)return;let a=JSON.parse(localStorage.getItem(e))||[],l=a.splice(t,1)[0];localStorage.setItem(e,JSON.stringify(a));let n=JSON.parse(localStorage.getItem("pathway-goals-past"))||[];n.unshift(l),localStorage.setItem("pathway-goals-past",JSON.stringify(n)),loadGoals()}function updateGoalField(e,t,a,l){let n=JSON.parse(localStorage.getItem(e))||[];n[t]&&(n[t][a]=l,localStorage.setItem(e,JSON.stringify(n)),loadGoals())}function handleKeydown(e,t,a,l,n){("Enter"===e.key||"Escape"===e.key)&&updateGoalField(t,a,l,n.textContent.trim())}window.addEventListener("load",function(){let e=document.getElementById("bingo-title");e.textContent=new Date().getFullYear()+" BINGO";let t=localStorage.getItem("pathway-view");t&&"pathway"!=t?"bingo"==t&&bingoStart():goalStart()});