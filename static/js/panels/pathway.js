const goalTypes=["pathway-goals-ongoing","pathway-goals-current","pathway-goals-next","pathway-goals-short","pathway-goals-medium","pathway-goals-long","pathway-goals-past"],goalTypeHeaders={"pathway-goals-ongoing":"Ongoing","pathway-goals-current":"Current","pathway-goals-next":"Next","pathway-goals-short":"Short Term","pathway-goals-medium":"Medium Term","pathway-goals-long":"Long Term","pathway-goals-past":"Past"},BINGO_BOARD_SIZE=5,CURRENT_YEAR=new Date().getFullYear();function buildBingoDropdown(){let e=JSON.parse(localStorage.getItem("bingo-years")),t=document.createElement("select");return t.id="bingo-dropdown",e.forEach(e=>{let a=document.createElement("option");a.value=e,a.textContent=e+" BINGO",e===CURRENT_YEAR&&(a.selected=!0),t.appendChild(a)}),t.addEventListener("change",function(){let e=this.value;bingoStart(e)}),t}function goalStart(){document.getElementById("main-title").classList.add("current-title"),document.getElementById("bingo-title").classList.remove("current-title"),document.getElementById("main-container").style.height="calc(100% - 60px)",document.getElementById("title-container").style.borderTop="2px solid var(--modeback)",loadGoals()}function bingoStart(e){document.getElementById("main-title").classList.remove("current-title"),document.getElementById("bingo-title").classList.add("current-title"),document.getElementById("main-container").style.height="calc(100% - 45px)",document.getElementById("title-container").style.borderTop="none",loadBingo(e)}function getUrlParams(){let e=new URLSearchParams(window.location.search);return{isPopped:e.get("popped")}}function setView(e){let t=localStorage.getItem("pathway-view"),a=JSON.parse(localStorage.getItem("bingo-years"));if(e==t)return;let n=document.getElementById("bingo-title");localStorage.setItem("pathway-view",e),n.innerHTML="","pathway"===e?(n.textContent=CURRENT_YEAR+" BINGO",goalStart()):"bingo"===e&&(a.length>1?n.appendChild(buildBingoDropdown()):n.textContent=CURRENT_YEAR+" BINGO",bingoStart(CURRENT_YEAR))}function loadBingo(e){let t="bingo-data-"+e,a=document.getElementById("goals-list");a.innerHTML="";let n=JSON.parse(localStorage.getItem(t)),l=document.createElement("table");l.classList.add("bingo-table");for(let i=0;i<5;i++){let o=document.createElement("tr");for(let s=0;s<5;s++){let r=document.createElement("td");r.classList.add("bingo-cell"),r.dataset.row=i,r.dataset.col=s;let d=document.createElement("span");d.classList.add("bingo-text"),d.textContent=n.texts[i][s],d.contentEditable=!0,d.spellcheck=!1,2===i&&2===s&&(d.textContent="Free",d.contentEditable=!1,r.classList.add("checked","checked-free"),n.checked[i][s]=!0),d.addEventListener("click",function(e){e.stopPropagation()}),d.addEventListener("input",function(){n.texts[i][s]=""==this.textContent?"...":this.textContent,localStorage.setItem(t,JSON.stringify(n))}),r.addEventListener("click",function(e){if(2!==i||2!==s){if(d.blur(),n.checked[i][s]=!n.checked[i][s],localStorage.setItem(t,JSON.stringify(n)),!this.classList.contains("checked")){let a=e.clientX/window.innerWidth,l=e.clientY/window.innerHeight;confetti({particleCount:40,spread:40,origin:{x:a,y:l},startVelocity:28}),makesBingo(n.checked,i,s)&&bingoConfetti(n.checked)}this.classList.toggle("checked"),checkBingo(n.checked)}}),n.checked[i][s]&&r.classList.add("checked"),r.appendChild(d),o.appendChild(r)}l.appendChild(o)}a.appendChild(l),checkBingo(n.checked)}function makesBingo(e,t,a){let n=e.map(e=>[...e]),l=countBingos(n);n[t][a]=!1;let i=countBingos(n);return l>i}function countBingos(e){let t=0;for(let a=0;a<5;a++)e[a].every(e=>e)&&t++,e.map(e=>e[a]).every(e=>e)&&t++;return e.map((e,t)=>e[t]).every(e=>e)&&t++,e.map((e,t)=>e[4-t]).every(e=>e)&&t++,t}function checkBingo(e){0==(bingoCount=countBingos(e))?document.querySelector(".bingo-cell.checked.checked-free").innerText="FREE":1==bingoCount?document.querySelector(".bingo-cell.checked.checked-free").innerText="BINGO":12==bingoCount?document.querySelector(".bingo-cell.checked.checked-free").innerText="FULL BINGO":document.querySelector(".bingo-cell.checked.checked-free").innerText="BINGO x"+bingoCount}function bingoConfetti(e){if((bingoCount=countBingos(e))<12){var t=Date.now()+1e3;!function e(){confetti({particleCount:7,angle:60,spread:55,origin:{x:0}}),confetti({particleCount:7,angle:120,spread:55,origin:{x:1}}),Date.now()<t&&requestAnimationFrame(e)}()}else{var a={spread:360,ticks:50,gravity:0,decay:.9,startVelocity:15,colors:["FFE400","FFBD00","E89400","FFCA6C","FDFFB8"]};function n(){confetti({...a,particleCount:40,scalar:1.2,shapes:["star"]}),confetti({...a,particleCount:10,scalar:.75,shapes:["circle"]})}setTimeout(n,0),setTimeout(n,100),setTimeout(n,200)}}function loadGoals(){let{isPopped:e}=getUrlParams(),t=document.getElementById("goals-list");t.innerHTML="";let a=!1;if(("true"===e?goalTypes:["pathway-goals-ongoing","pathway-goals-current"]).forEach(n=>{let l=JSON.parse(localStorage.getItem(n))||[];if(0===l.length&&"true"!==e)return;a=a||l.length>0;let i=document.createElement("div");if(i.classList.add("goal-section"),i.classList.add(`${goalTypeHeaders[n].toLowerCase().replace(/\s+/g,"-")}`),"false"==e&&i.classList.add("glance-view"),"true"===e){let o=document.createElement("div");o.className="goal-section-header",o.classList.add(`${goalTypeHeaders[n].toLowerCase().replace(/\s+/g,"-")}`),o.innerHTML=`<span class="header-chevron">&#9660;</span> ${goalTypeHeaders[n]}`;let s=o.querySelector(".header-chevron");o.addEventListener("click",()=>{let e=i.querySelectorAll(".goal"),t=i.querySelector(".add-goal-container"),a=i.querySelector(".no-goals"),n="â–¶"==s.textContent;s.innerHTML=n?"&#9660;":"&#9654;",e.forEach(e=>{e.style.display=n?"flex":"none"}),t&&(t.style.display=n?"flex":"none"),a&&(a.style.display=n?"block":"none")}),i.appendChild(o)}if(0===l.length){let r=document.createElement("div");r.className="no-goals",r.textContent="(No goals yet)",i.appendChild(r)}else l.forEach((t,a)=>{let l=document.createElement("div");l.className="goal","false"==e&&l.classList.add("glance-view");let o=document.createElement("div");if(o.className="goal-title","true"===e){o.innerHTML=`<span class="editable-value title">${t.name}</span>`;let s=o.querySelector(".editable-value");s.contentEditable="true",s.addEventListener("blur",()=>{updateGoalField(n,a,"name",s.textContent.trim())}),s.addEventListener("keydown",e=>handleKeydown(e,n,a,"name",s))}else o.innerHTML=t.name;l.appendChild(o);let r=document.createElement("div");if(r.className="goal-category","true"===e){r.innerHTML=`<span class="editable-value">${t.category}</span>`;let d=r.querySelector(".editable-value");d.contentEditable="true",d.addEventListener("blur",()=>{updateGoalField(n,a,"category",d.textContent.trim())}),d.addEventListener("keydown",e=>handleKeydown(e,n,a,"category",d))}else r.innerHTML=`${t.category}`;if(l.appendChild(r),"true"===e){let c=document.createElement("div");c.className="goal-milestone",t.milestone?c.innerHTML=`<span class="editable-value">${t.milestone}</span>`:c.innerHTML='<span class="editable-value">_</span>';let g=c.querySelector(".editable-value");g.contentEditable="true",g.addEventListener("blur",()=>{updateGoalField(n,a,"milestone",g.textContent.trim())}),g.addEventListener("keydown",e=>handleKeydown(e,n,a,"milestone",g)),l.appendChild(c)}if("true"===e){let p=document.createElement("div");p.classList.add("goal-actions");let m=document.createElement("button");m.innerHTML="&#8613;",m.addEventListener("click",()=>promoteGoal(n,a)),p.appendChild(m);let u=document.createElement("button");u.innerHTML="&#8615;",u.addEventListener("click",()=>demoteGoal(n,a)),p.appendChild(u);let h=document.createElement("button");h.innerHTML="&#9745;",h.addEventListener("click",()=>completeGoal(n,a)),p.appendChild(h);let y=document.createElement("button");y.className="action-remove",y.innerHTML="&#10006;",y.addEventListener("click",()=>removeGoal(n,a)),p.appendChild(y),l.appendChild(p)}i.appendChild(l)});if("true"===e){let d=document.createElement("div");d.classList.add("add-goal-container");let c=document.createElement("input");c.type="text",c.className="flex-name-input",c.id=`goal-name-input-${n}`,c.placeholder="Goal Name";let g=document.createElement("input");g.type="text",g.className="flex-category-input",g.id=`goal-category-input-${n}`,g.placeholder="Category";let p=document.createElement("input");p.type="text",p.className="flex-milestone-input",p.id=`goal-milestone-input-${n}`,"pathway-goals-past"==n?p.placeholder="Result (Optional)":p.placeholder="Next Milestone (Optional)";let m=document.createElement("button");m.textContent="+",m.addEventListener("click",()=>{addGoal(n)}),d.appendChild(c),d.appendChild(g),d.appendChild(p),d.appendChild(m),i.appendChild(d)}t.appendChild(i)}),!a&&"false"==e){let n=document.createElement("div");n.className="no-goals-overall",n.innerHTML="No ongoing or current goals<br>Click <span>&#10063;</span> to add goals",t.appendChild(n)}}function addGoal(e){let t=document.getElementById(`goal-name-input-${e}`),a=document.getElementById(`goal-category-input-${e}`),n=document.getElementById(`goal-milestone-input-${e}`),l=t.value.trim(),i=a.value.trim(),o=n.value.trim();if(!l||!i){alert("Both Goal name and Category are required to add a goal.");return}let s=JSON.parse(localStorage.getItem(e))||[];s.push({name:l,category:i,milestone:o||""}),localStorage.setItem(e,JSON.stringify(s)),t.value="",a.value="",n.value="",loadGoals()}function removeGoal(e,t){let a=JSON.parse(localStorage.getItem(e))||[];a.splice(t,1),localStorage.setItem(e,JSON.stringify(a)),loadGoals()}function promoteGoal(e,t){let a=goalTypes.indexOf(e);if(0==a)return;let n=JSON.parse(localStorage.getItem(e))||[],l=n.splice(t,1)[0];localStorage.setItem(e,JSON.stringify(n));let i=goalTypes[a-1],o=JSON.parse(localStorage.getItem(i))||[];o.push(l),localStorage.setItem(i,JSON.stringify(o)),loadGoals()}function demoteGoal(e,t){let a=goalTypes.indexOf(e);if(a==goalTypes.length-1)return;let n=JSON.parse(localStorage.getItem(e))||[],l=n.splice(t,1)[0];localStorage.setItem(e,JSON.stringify(n));let i;if(a===goalTypes.length-2){i="pathway-goals-past";let o=JSON.parse(localStorage.getItem(i))||[];o.unshift(l),localStorage.setItem(i,JSON.stringify(o))}else{i=goalTypes[a+1];let s=JSON.parse(localStorage.getItem(i))||[];s.push(l),localStorage.setItem(i,JSON.stringify(s))}loadGoals()}function completeGoal(e,t){if("pathway-goals-past"==e)return;let a=JSON.parse(localStorage.getItem(e))||[],n=a.splice(t,1)[0];localStorage.setItem(e,JSON.stringify(a));let l=JSON.parse(localStorage.getItem("pathway-goals-past"))||[];l.unshift(n),localStorage.setItem("pathway-goals-past",JSON.stringify(l)),loadGoals()}function updateGoalField(e,t,a,n){let l=JSON.parse(localStorage.getItem(e))||[];l[t]&&(l[t][a]=n,localStorage.setItem(e,JSON.stringify(l)),loadGoals())}function handleKeydown(e,t,a,n,l){("Enter"===e.key||"Escape"===e.key)&&updateGoalField(t,a,n,l.textContent.trim())}window.addEventListener("load",function(){let e=localStorage.getItem("pathway-view"),t=document.getElementById("bingo-title"),a=JSON.parse(localStorage.getItem("bingo-data-"+CURRENT_YEAR));if(!a){let n=JSON.parse(localStorage.getItem("bingo-data"));n?(a=n,localStorage.removeItem("bingo-data")):a={checked:Array.from({length:5},()=>[,,,,,].fill(!1)),texts:Array.from({length:5},()=>[,,,,,].fill("..."))},localStorage.setItem("bingo-data-"+CURRENT_YEAR,JSON.stringify(a))}let l=localStorage.getItem("bingo-years"),i=l?JSON.parse(l):[CURRENT_YEAR];i.includes(CURRENT_YEAR)||i.push(CURRENT_YEAR),i=[...new Set(i)].sort((e,t)=>t-e),localStorage.setItem("bingo-years",JSON.stringify(i)),t.innerHTML="",e&&"pathway"!=e?"bingo"==e&&(i.length>1?t.appendChild(buildBingoDropdown()):t.textContent=CURRENT_YEAR+" BINGO",bingoStart(CURRENT_YEAR)):(t.textContent=CURRENT_YEAR+" BINGO",goalStart())});